<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œí™˜ìˆ˜ ë°°ì¹˜ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        /*
         * ì „ì—­ ìŠ¤íƒ€ì¼ ë° ë ˆì´ì•„ì›ƒ ì„¤ì •
         * ì „ì²´ í˜ì´ì§€ ì½˜í…ì¸ ë¥¼ ì„¸ë¡œë¡œ ì¤‘ì•™ ì •ë ¬í•©ë‹ˆë‹¤.
         */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        /*
         * ì „ì¥ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼
         * 17x9 í¬ê¸°ì˜ ì „ì¥ ê·¸ë¦¬ë“œë¥¼ ì •ì˜í•˜ë©°, ì…€ ê°„ê²©ê³¼ í…Œë‘ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
         */
        .battlefield-container {
            display: grid;
            grid-template-columns: repeat(17, 60px); /* 17ê°œ ì—´, ê° ì—´ 60px */
            grid-template-rows: repeat(9, 60px);   /* 9ê°œ í–‰, ê° í–‰ 60px */
            gap: 2px; /* ê·¸ë¦¬ë“œ ì…€ ì‚¬ì´ ê°„ê²© */
            border: 2px solid #666; /* í…Œë‘ë¦¬ */
            width: fit-content; /* ë‚´ìš©ë¬¼ì— ë§ì¶° ë„ˆë¹„ ìë™ ì¡°ì ˆ */
            margin-bottom: 30px; /* í•˜ë‹¨ ì—¬ë°± */
            background-color: #e0ffe0; /* ì—°í•œ ì´ˆë¡ìƒ‰ ë°°ê²½ */
        }

        /*
         * ì „ì¥ ê·¸ë¦¬ë“œì˜ ê°œë³„ ì…€ ìŠ¤íƒ€ì¼
         * ì…€ì˜ ê¸°ë³¸ í¬ê¸°ì™€ í…Œë‘ë¦¬, ê·¸ë¦¬ê³  ì†Œí™˜ìˆ˜ ê°œìˆ˜ì— ë”°ë¥¸ ë‚´ë¶€ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒì„ ì •ì˜í•©ë‹ˆë‹¤.
         */
        .battlefield-cell {
            width: 60px;
            height: 60px;
            border: 1px dotted #aaa; /* ì ì„  í…Œë‘ë¦¬ */
            display: grid; 
            grid-template-columns: 1fr; /* ê¸°ë³¸ì ìœ¼ë¡œ 1x1 ê·¸ë¦¬ë“œ (ì†Œí™˜ìˆ˜ 1ë§ˆë¦¬ì¼ ë•Œ) */
            grid-template-rows: 1fr;    /* ê¸°ë³¸ì ìœ¼ë¡œ 1x1 ê·¸ë¦¬ë“œ (ì†Œí™˜ìˆ˜ 1ë§ˆë¦¬ì¼ ë•Œ) */
            gap: 0; /* ë‚´ë¶€ ê·¸ë¦¬ë“œ ì…€ ê°„ê²© ì—†ìŒ */
            font-size: 8px; /* ì „ì¥ ì†Œí™˜ìˆ˜ ë‚´ í…ìŠ¤íŠ¸ í¬ê¸° (ì£¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ) */
            position: relative; /* ë¦¬ë” ë§ˆì»¤ ìœ„ì¹˜ ì§€ì •ì„ ìœ„í•œ ê¸°ì¤€ */
            box-sizing: border-box; /* íŒ¨ë”©ê³¼ ë³´ë”ê°€ ë„ˆë¹„ì— í¬í•¨ë˜ë„ë¡ ê³„ì‚° */
            overflow: hidden; /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ (ì†Œí™˜ìˆ˜ í¬ê¸°ê°€ ì…€ì— ë§ì¶°ì§€ë¯€ë¡œ ì£¼ë¡œ ë°œìƒ ì•ˆí•¨) */
        }

        /* ì†Œí™˜ìˆ˜ê°€ 2ë§ˆë¦¬ì¼ ë•Œ ì „ì¥ ì…€ ë‚´ë¶€ ìŠ¤íƒ€ì¼ (ê°€ë¡œ 2ë¶„í• , ì„¸ë¡œ 100%) */
        .battlefield-cell.multi-summoners {
            grid-template-columns: repeat(2, 1fr); /* 2ê°œ ì—´ (ê° 50% ë„ˆë¹„) */
            grid-template-rows: 1fr; /* 1ê°œ í–‰ (ì„¸ë¡œ 100% ì‚¬ìš©) */
        }
        /* ì†Œí™˜ìˆ˜ê°€ 3ë§ˆë¦¬ ì´ìƒì¼ ë•Œ ì „ì¥ ì…€ ë‚´ë¶€ ìŠ¤íƒ€ì¼ (2x2 ë¶„í• ) */
        .battlefield-cell.multi-summoners.three-plus {
            grid-template-rows: repeat(2, 1fr); /* 2ê°œ í–‰ (ê° 50% ë†’ì´) */
        }
        /* ì „ì¥ì˜ ê³µìœ  ì˜ì—­ ì…€ ë°°ê²½ìƒ‰ */
        .battlefield-cell.shared-column {
            background-color: #d0d0ff; /* ì—°í•œ ë³´ë¼ìƒ‰ ë°°ê²½ */
        }
        
        /*
         * ì „ì¥ì— ë°°ì¹˜ë˜ëŠ” ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼
         * ì´ ìš”ì†ŒëŠ” ì „ì¥ ì…€ ë‚´ì˜ í•˜ìœ„ ê·¸ë¦¬ë“œ ì•„ì´í…œìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
         */
        .battlefield-summoner {
            border-radius: 3px; /* ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ì´ë¦„ ëŒ€ì‹  ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì˜ ë³´ì´ì§€ ì•ŠìŒ) */
            font-weight: bold;
            font-size: 8px; 
            text-align: center;
            line-height: 1;
            padding: 1px; /* ë‚´ë¶€ ì—¬ë°± */
            box-sizing: border-box;
            margin: 0; /* ë‚´ë¶€ ê·¸ë¦¬ë“œ ì•„ì´í…œì´ë¯€ë¡œ ê¸°ë³¸ ë§ˆì§„ ì—†ìŒ */
            overflow: hidden; /* ì´ë¯¸ì§€ê°€ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ */
        }
        /* ì „ì¥ ì†Œí™˜ìˆ˜ ë‚´ë¶€ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .battlefield-summoner img {
            width: 100%; /* ë¶€ëª¨ ìš”ì†Œ(battlefield-summoner) í¬ê¸°ì— ê½‰ ì±„ì›€ */
            height: 100%;
            object-fit: cover; /* ì´ë¯¸ì§€ê°€ ì˜ë¦¬ì§€ ì•Šê³  ì˜ì—­ì„ ì±„ìš°ë„ë¡ */
            border-radius: 3px; /* ë¶€ëª¨ ìš”ì†Œì™€ ë™ì¼í•˜ê²Œ ë‘¥ê¸€ê²Œ */
        }

        /* ì „ì¥ ì†Œí™˜ìˆ˜: 1ë§ˆë¦¬ì¼ ë•Œ í¬ê¸° (ì…€ ì „ì²´ ì‚¬ìš©) */
        .battlefield-summoner.single-summoner {
            width: calc(100% - 2px); /* ì…€ ê°€ë¡œ ë„ˆë¹„ì—ì„œ ì¢Œìš° 1px ë§ˆì§„ ì œì™¸ */
            height: calc(100% - 2px); /* ì…€ ì„¸ë¡œ ë†’ì´ì—ì„œ ìƒí•˜ 1px ë§ˆì§„ ì œì™¸ */
            margin: 1px; /* ì…€ í…Œë‘ë¦¬ ë° ì†Œí™˜ìˆ˜ ê°„ ì—¬ë°± */
        }
        /* ì „ì¥ ì†Œí™˜ìˆ˜: 2ë§ˆë¦¬ ì´ìƒì¼ ë•Œ í¬ê¸° (í•˜ìœ„ ê·¸ë¦¬ë“œ ì…€ì— ë§ì¶° ì¡°ì •) */
        .battlefield-summoner.multi-summoner {
            width: calc(100% - 2px); /* í•˜ìœ„ ê·¸ë¦¬ë“œ ì—´ì˜ 100%ì—ì„œ ì¢Œìš° 1px ë§ˆì§„ ì œì™¸ */
            height: calc(100% - 2px); /* í•˜ìœ„ ê·¸ë¦¬ë“œ í–‰ì˜ 100%ì—ì„œ ìƒí•˜ 1px ë§ˆì§„ ì œì™¸ */
            margin: 1px; /* í•˜ìœ„ ì…€ ë‚´ì—ì„œ ë§ˆì§„ */
        }

        /* ë‚˜ì˜ ì†Œí™˜ìˆ˜ ë°°ê²½ìƒ‰ */
        .battlefield-summoner.my-summoner {
            background-color: #2196F3; /* íŒŒë€ìƒ‰ */
        }
        /* ìƒëŒ€í¸ ì†Œí™˜ìˆ˜ ë°°ê²½ìƒ‰ */
        .battlefield-summoner.opponent-summoner {
            background-color: #f44336; /* ë¹¨ê°„ìƒ‰ */
        }
        /* ì „ì¥ ë¦¬ë” ë§ˆì»¤ (ì‘ì€ ì™•ê´€ ì´ëª¨ì§€) */
        .battlefield-leader-marker {
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 7px;
            color: gold;
            text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.7);
        }

        /*
         * ë°°ì¹˜ ê·¸ë¦¬ë“œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ (ë‚˜ì˜ ë°°ì¹˜ ê·¸ë¦¬ë“œì™€ ìƒëŒ€í¸ ë°°ì¹˜ ê·¸ë¦¬ë“œë¥¼ í¬í•¨)
         * ë‘ ê·¸ë¦¬ë“œë¥¼ ê°€ë¡œë¡œ ë‚˜ë€íˆ ë°°ì¹˜í•˜ê³  ì¤‘ì•™ ì •ë ¬í•©ë‹ˆë‹¤.
         */
        .placement-section {
            display: flex;
            width: 100%;
            justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
            gap: 50px; /* ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ ì‚¬ì´ ê°„ê²© */
            margin-bottom: 30px; /* í•˜ë‹¨ ì—¬ë°± */
        }

        /* ê°œë³„ ë°°ì¹˜ ê·¸ë¦¬ë“œ ë˜í¼ (ì œëª©, ì¹´ìš´íŠ¸ UI, ì‹¤ì œ ê·¸ë¦¬ë“œë¥¼ í¬í•¨) */
        .grid-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; /* ë°°ì¹˜ ìˆ˜ UIë¥¼ ìœ„í•œ ìœ„ì¹˜ ê¸°ì¤€ */
        }

        /* ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ ìˆ˜ë¥¼ í‘œì‹œí•˜ëŠ” UI (ì˜ˆ: "N/15") */
        .grid-count-display {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.7); /* ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
            color: white; /* í°ìƒ‰ í…ìŠ¤íŠ¸ */
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            z-index: 20; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ */
        }

        /* 5x5 ë°°ì¹˜ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 60px); /* 5ê°œ ì—´, ê° 60px */
            grid-template-rows: repeat(5, 60px);   /* 5ê°œ í–‰, ê° 60px */
            gap: 5px; /* ì…€ ì‚¬ì´ ê°„ê²© */
            border: 2px solid #333; /* í…Œë‘ë¦¬ */
            width: fit-content; /* ë‚´ìš©ë¬¼ì— ë§ì¶° ë„ˆë¹„ ìë™ ì¡°ì ˆ */
        }
        /* ë°°ì¹˜ ê·¸ë¦¬ë“œì˜ ê°œë³„ ì…€ */
        .grid-cell {
            width: 60px;
            height: 60px;
            border: 1px solid #ccc; /* ì˜…ì€ íšŒìƒ‰ í…Œë‘ë¦¬ */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            cursor: default; /* ì…€ ìì²´ëŠ” í´ë¦­ ê°€ëŠ¥í•˜ì§€ ì•ŠìŒ (ë²„íŠ¼ ì‚¬ìš©) */
            background-color: #f0f0f0; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            position: relative; /* ì†Œí™˜ìˆ˜ ë²„íŠ¼ ìœ„ì¹˜ ì§€ì •ì„ ìœ„í•œ ê¸°ì¤€ */
        }

        /*
         * ì†Œí™˜ìˆ˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (í’€ì˜ ì†Œí™˜ìˆ˜, ë°°ì¹˜ ê·¸ë¦¬ë“œì˜ ì†Œí™˜ìˆ˜ì— ëª¨ë‘ ì ìš©)
         * ì´ ìŠ¤íƒ€ì¼ì€ .battlefield-summoner ìŠ¤íƒ€ì¼ì— ì˜í•´ ì¼ë¶€ ì˜¤ë²„ë¼ì´ë“œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
         */
        .summoner { 
            width: 50px; /* ê¸°ë³¸ ì†Œí™˜ìˆ˜ í¬ê¸° */
            height: 50px; 
            background-color: #4CAF50; /* í’€ì— ìˆì„ ë•Œì˜ ê¸°ë³¸ìƒ‰ (ì´ˆë¡ìƒ‰) */
            border-radius: 5px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ì´ë¦„ ëŒ€ì‹  ì´ë¯¸ì§€) */
            font-weight: bold;
            font-size: 10px;
            text-align: center;
            line-height: 1.2;
            padding: 2px; /* ë‚´ë¶€ ì—¬ë°± */
            box-sizing: border-box;
            position: relative; /* ì†Œí™˜ìˆ˜ ë²„íŠ¼ ìœ„ì¹˜ ì§€ì •ì„ ìœ„í•œ ê¸°ì¤€ */
            overflow: hidden; /* ë‚´ë¶€ ì´ë¯¸ì§€ê°€ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ */
        }
        /* ì†Œí™˜ìˆ˜ ë‚´ë¶€ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ (í’€ ë° ë°°ì¹˜ ê·¸ë¦¬ë“œ) */
        .summoner img {
            width: 100%; /* ë¶€ëª¨ ì†Œí™˜ìˆ˜ í¬ê¸°ì— ê½‰ ì±„ì›€ */
            height: 100%;
            object-fit: cover; /* ì´ë¯¸ì§€ê°€ ì˜ë¦¬ì§€ ì•Šê³  ì˜ì—­ì„ ì±„ìš°ë„ë¡ */
            border-radius: 5px; /* ë¶€ëª¨ì™€ ë™ì¼í•˜ê²Œ ë‘¥ê¸€ê²Œ */
        }

        /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ í’€ ì†Œí™˜ìˆ˜ (í’€ì— ìˆì„ ë•Œë§Œ ì ìš©ë˜ëŠ” ì¶”ê°€ ìŠ¤íƒ€ì¼) */
        .summoner-draggable {
            cursor: grab; /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ì»¤ì„œ ëª¨ì–‘ */
            margin: 5px; /* í’€ ë‚´ ì†Œí™˜ìˆ˜ ì‚¬ì´ ê°„ê²© */
            background-color: #4CAF50; /* í’€ì˜ ì†Œí™˜ìˆ˜ëŠ” ê¸°ë³¸ ì´ˆë¡ìƒ‰ìœ¼ë¡œ í†µì¼ */
        }
        /* ë°°ì¹˜ëœ ë‚˜ì˜ ì†Œí™˜ìˆ˜ ìƒ‰ìƒ (is-placed ë°ì´í„° ì†ì„± í™•ì¸) */
        .summoner[data-is-opponent="false"].is-placed {
            background-color: #2196F3; /* íŒŒë€ìƒ‰ */
        }
        /* ë°°ì¹˜ëœ ìƒëŒ€í¸ ì†Œí™˜ìˆ˜ ìƒ‰ìƒ (is-placed ë°ì´í„° ì†ì„± í™•ì¸) */
        .summoner[data-is-opponent="true"].is-placed {
            background-color: #f44336; /* ë¹¨ê°„ìƒ‰ */
        }

        /* ë¦¬ë” ì†Œí™˜ìˆ˜ í…Œë‘ë¦¬ íš¨ê³¼ */
        .is-leader {
            border: 3px solid gold; /* ê¸ˆìƒ‰ í…Œë‘ë¦¬ */
            box-shadow: 0 0 10px gold; /* ê¸ˆìƒ‰ ê·¸ë¦¼ì íš¨ê³¼ */
        }
        /* ì†Œí™˜ìˆ˜ ìœ„ì— í‘œì‹œë˜ëŠ” ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ (ë¦¬ë” ë²„íŠ¼, ì œê±° ë²„íŠ¼) */
        .summoner-button {
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%; /* ì›í˜• ë²„íŠ¼ */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10; /* ì†Œí™˜ìˆ˜ ìœ„ì— í‘œì‹œë˜ë„ë¡ */
        }
        /* ë¦¬ë” ì§€ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .leader-button {
            top: -5px; /* ì†Œí™˜ìˆ˜ ì¢Œì¸¡ ìƒë‹¨ìœ¼ë¡œ ì´ë™ */
            left: -5px;
            background-color: #ffd700; /* ê¸ˆìƒ‰ ë°°ê²½ */
            color: #333; /* ì–´ë‘ìš´ ê¸€ììƒ‰ */
            border: 1px solid #ccaa00;
        }
        .leader-button:hover {
            background-color: #ffeb3b; /* í˜¸ë²„ ì‹œ ë°ê²Œ */
        }
        /* ì œê±° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .remove-button {
            top: -5px; /* ì†Œí™˜ìˆ˜ ìš°ì¸¡ ìƒë‹¨ìœ¼ë¡œ ì´ë™ */
            right: -5px;
            background-color: #f44336; /* ë¹¨ê°„ìƒ‰ ë°°ê²½ */
            color: white; /* í°ìƒ‰ ê¸€ì */
            border: 1px solid #d32f2f;
        }
        .remove-button:hover {
            background-color: #ef5350; /* í˜¸ë²„ ì‹œ ë°ê²Œ */
        }

        /*
         * ê³µìš© ì†Œí™˜ìˆ˜ í’€ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼
         * ëª¨ë“  ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ ìš”ì†Œë“¤ì„ ë‹´ê³  ì¤„ë°”ê¿ˆí•˜ì—¬ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        .summoners-pool {
            display: flex;
            flex-wrap: wrap; /* ì†Œí™˜ìˆ˜ë“¤ì´ ë§ìœ¼ë©´ ë‹¤ìŒ ì¤„ë¡œ ì¤„ë°”ê¿ˆ */
            gap: 10px; /* ì†Œí™˜ìˆ˜ ìš”ì†Œë“¤ ì‚¬ì´ ê°„ê²© */
            margin-top: 20px;
            border: 1px solid #eee; /* ì˜…ì€ íšŒìƒ‰ í…Œë‘ë¦¬ */
            padding: 10px; /* ë‚´ë¶€ ì—¬ë°± */
            width: 1000px; /* ì „ì¥ ê·¸ë¦¬ë“œ ë„ˆë¹„ì— ë§ì¶° ì„¤ì • */
            justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
            margin-bottom: 20px;
        }

        /* ì œì–´ ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .control-buttons {
            margin-top: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap; /* ë²„íŠ¼ì´ ë§ì•„ì§€ë©´ ì¤„ë°”ê¿ˆ */
            gap: 15px;
            align-items: center; /* ìˆ˜ì§ ì •ë ¬ */
            justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
            width: 1000px; /* ì „ì²´ ë„ˆë¹„ */
            max-width: 100%;
        }
        .control-buttons button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s;
            flex-shrink: 0; /* ë²„íŠ¼ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        }
        .control-buttons button:hover {
            background-color: #0056b3;
        }
        .control-buttons button.clear-button {
            background-color: #dc3545;
        }
        .control-buttons button.clear-button:hover {
            background-color: #c82333;
        }

        /* í¸ì„± ì„ íƒ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .arrangement-selection {
            display: flex;
            flex-wrap: nowrap; /* ë³€ê²½: ì¤„ë°”ê¿ˆ ëŒ€ì‹  ìŠ¤í¬ë¡¤ */
            overflow-x: auto;  /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” í‘œì‹œ */
            gap: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px;
            flex-grow: 1; /* ë‚¨ì€ ê³µê°„ì„ ì±„ìš°ë„ë¡ ì„±ì¥ */
            justify-content: flex-start; /* ì¢Œì¸¡ ì •ë ¬ */
            align-items: center;
            min-width: 200px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
        }
        /* í¸ì„± ì„ íƒ ë²„íŠ¼ ê°œë³„ ìŠ¤íƒ€ì¼ */
        .arrangement-selection button {
            padding: 8px 12px;
            font-size: 14px;
            background-color: #e9ecef;
            color: #495057;
            border: 1px solid #adb5bd;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            flex-shrink: 0; /* ë²„íŠ¼ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        }
        .arrangement-selection button:hover {
            background-color: #dee2e6;
        }
        .arrangement-selection button.active-arrangement {
            background-color: #28a745; /* í™œì„±í™”ëœ í¸ì„± ìƒ‰ìƒ (ì´ˆë¡ìƒ‰) */
            color: white;
            border-color: #218838;
            font-weight: bold;
        }

        /* í¸ì„± ì¶”ê°€ ë²„íŠ¼ (í”ŒëŸ¬ìŠ¤ ë²„íŠ¼) ìŠ¤íƒ€ì¼ */
        .arrangement-selection button.add-arrangement-button {
            background-color: #6c757d; /* íšŒìƒ‰ ë°°ê²½ */
            color: white;
            font-weight: bold;
            font-size: 18px; /* í¬ê²Œ */
            padding: 5px 10px; /* íŒ¨ë”© ì¡°ì • */
        }
        .arrangement-selection button.add-arrangement-button:hover {
            background-color: #5a6268;
        }
        /* í¸ì„± ì´ë¦„ ë³€ê²½ ë²„íŠ¼ */
        .arrangement-selection .rename-arrangement-button {
            background-color: #17a2b8; /* ì²­ë¡ìƒ‰ */
            color: white;
            font-weight: bold;
            font-size: 10px;
            width: 18px;
            height: 18px;
            line-height: 1;
            border-radius: 50%;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 4px; /* ì™¼ìª½ ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
            border: none;
        }
        .arrangement-selection .rename-arrangement-button:hover {
            background-color: #138496;
        }
        /* í¸ì„± ì‚­ì œ ë²„íŠ¼ (í¸ì„± ë²„íŠ¼ ì˜†ì— ì‘ì€ X ë²„íŠ¼) */
        .arrangement-selection .delete-arrangement-button {
            background-color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
            color: white;
            font-weight: bold;
            font-size: 10px;
            width: 18px; /* ì‘ê²Œ */
            height: 18px;
            line-height: 1;
            border-radius: 50%; /* ì›í˜• */
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 4px; /* ì™¼ìª½ ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
            border: none;
            z-index: 5; 
            position: relative;
        }
        .arrangement-selection .delete-arrangement-button:hover {
            background-color: #c82333;
        }
        /* í¸ì„± ë²„íŠ¼ê³¼ ì‚­ì œ ë²„íŠ¼ì„ ë¬¶ëŠ” ì»¨í…Œì´ë„ˆ */
        .arrangement-item {
            display: flex;
            align-items: center;
            flex-shrink: 0; /* ì•„ì´í…œì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #toast-message {
            visibility: hidden; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            min-width: 250px;
            background-color: rgba(51, 51, 51, 0.9); /* ë°˜íˆ¬ëª… ê²€ì • ë°°ê²½ */
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 16px;
            position: fixed; /* ê³ ì • ìœ„ì¹˜ */
            z-index: 9999; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            left: 50%; /* ê°€ë¡œ ì¤‘ì•™ */
            top: 50%; /* ì„¸ë¡œ ì¤‘ì•™ (translateë¡œ ì •í™•í•œ ì¤‘ì•™ ì¡°ì •) */
            transform: translate(-50%, -50%); /* ì •í™•í•œ ì¤‘ì•™ ì •ë ¬ */
            opacity: 0; /* ì´ˆê¸° íˆ¬ëª…ë„ */
            transition: opacity 0.5s, visibility 0.5s; /* ë¶€ë“œëŸ¬ìš´ ë‚˜íƒ€ë‚¨/ì‚¬ë¼ì§ íš¨ê³¼ */
        }
        #toast-message.show {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>ì†Œí™˜ìˆ˜ ë°°ì¹˜ ì‹œë®¬ë ˆì´ì…˜</h1>

    <h2>ì „ì¥</h2>
    <div id="battlefield-grid" class="battlefield-container">
        </div>

    <div class="placement-section">
        <div class="grid-wrapper">
            <h2>ë‚˜ì˜ ë°°ì¹˜</h2>
            <div id="my-grid-count" class="grid-count-display">0/15</div> 
            <div id="my-grid" class="grid-container">
                </div>
        </div>

        <div class="grid-wrapper">
            <h2>ìƒëŒ€í¸ ë°°ì¹˜</h2>
            <div id="opponent-grid-count" class="grid-count-display">0/15</div> 
            <div id="opponent-grid" class="grid-container">
                </div>
        </div>
    </div>

    <div class="control-buttons">
        <div class="arrangement-selection" id="arrangement-buttons-container">
            <!-- í¸ì„± ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë  ê²ƒì…ë‹ˆë‹¤ -->
            <button class="add-arrangement-button" id="add-arrangement-button-id">+</button>
        </div>
        <button id="save-arrangement-button">í˜„ì¬ í¸ì„± ì €ì¥</button>
        <button id="clear-current-arrangement-button">í˜„ì¬ í¸ì„± ë¹„ìš°ê¸°</button>
        <button id="clear-all-arrangements-button" class="clear-button">ëª¨ë“  í¸ì„± ì´ˆê¸°í™”</button>
    </div>

    <hr>

    <h3>ì†Œí™˜ìˆ˜ ëª©ë¡ (í’€ì—ì„œ ë“œë˜ê·¸í•˜ì—¬ ë°°ì¹˜)</h3>
    <div id="common-summoners-pool" class="summoners-pool">
        </div>

    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì˜ì—­ -->
    <div id="toast-message"></div>

    <script>
        // DOM ìš”ì†Œì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const opponentGrid = document.getElementById('opponent-grid');
        const myGrid = document.getElementById('my-grid');
        const commonSummonersPool = document.getElementById('common-summoners-pool');
        const battlefieldGrid = document.getElementById('battlefield-grid');
        const myGridCountDisplay = document.getElementById('my-grid-count');
        const opponentGridCountDisplay = document.getElementById('opponent-grid-count');
        const arrangementButtonsContainer = document.getElementById('arrangement-buttons-container');
        const addArrangementButton = document.getElementById('add-arrangement-button-id'); // + ë²„íŠ¼ ì°¸ì¡° ì¶”ê°€
        const toastMessage = document.getElementById('toast-message'); // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ DOM ì¶”ê°€

        // ê²Œì„ì˜ ì „ë°˜ì ì¸ ì„¤ì •ì„ ìœ„í•œ ìƒìˆ˜ë“¤
        const grid5x5Size = 5; // ë°°ì¹˜ ê·¸ë¦¬ë“œì˜ í¬ê¸° (5x5 ì…€)
        const maxSummoners = 15; // ê° ì§„ì˜ì´ ë°°ì¹˜í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì†Œí™˜ìˆ˜ ìˆ˜
        const maxArrangements = 10; // ìµœëŒ€ í¸ì„± ìŠ¬ë¡¯ ê°œìˆ˜

        // ì „ì¥ ê·¸ë¦¬ë“œì˜ í¬ê¸° ì„¤ì •
        const battlefieldCols = 17; // ì „ì¥ ê·¸ë¦¬ë“œì˜ ì—´ ê°œìˆ˜
        const battlefieldRows = 9;   // ì „ì¥ ê·¸ë¦¬ë“œì˜ í–‰ ê°œìˆ˜
        
        // ì „ì¥ ê·¸ë¦¬ë“œì˜ ì„¸ë¡œ ì¤‘ì•™ í–‰ì„ ê³„ì‚°í•©ë‹ˆë‹¤ (9í–‰ì˜ ê²½ìš° ì¸ë±ìŠ¤ 4).
        const battlefieldVerticalCenterRow = Math.floor(battlefieldRows / 2); 

        // ë‚˜ì˜ ë¦¬ë”ê°€ ì „ì¥ì—ì„œ ë°°ì¹˜ë  ì—´ì˜ ì¸ë±ìŠ¤ (5ë²ˆì§¸ ì—´, ì¦‰ ì¸ë±ìŠ¤ 4)
        const myLeaderBattlefieldCol = 6; 
        // ìƒëŒ€í¸ ë¦¬ë”ê°€ ì „ì¥ì—ì„œ ë°°ì¹˜ë  ì—´ì˜ ì¸ë±ìŠ¤ (13ë²ˆì§¸ ì—´, ì¦‰ ì¸ë±ìŠ¤ 12)
        const opponentLeaderBattlefieldCol = 10;

        // ê²Œì„ì— ì‚¬ìš©ë  ì†Œí™˜ìˆ˜ë“¤ì˜ ì´ë¦„ ëª©ë¡ì„ ê°€ë‚˜ë‹¤ìˆœìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
        const summonerNames = [
            'ì‚¬ë¸Œë¦¬ë‚˜', 'í…Œì‚¬ë¦¬ì˜¨', 'ì•„ë¥´íƒ€ë¯¸ì—˜', 'íˆ¬ì „ìŠ¹ë¶ˆ', 'ë¼ì´ë§ˆ', 'ë©œë¦¬ì‚¬', 'ì¹´ì‚°ë“œë¼', 
            'ìƒ¬ë¡¯', 'ì• ë„ˆë²¨', 'ì”ëŠ', 'ì‹œí™”', 'ê·¸ë¡œê²', 'ë¦¬ë‚˜', 'ë¸í¬ì´', 'ì˜¤í•„ë¦¬ì•„', 
            'ë°”ë„¤ì‚¬', 'í’ì—°', 'ë² ë¥´ë°í•˜ì¼', 'ë£¨ì‰”', 'ì…€ë ˆìŠ¤í‹°ì•„', 'ì•„ì´ë¦¬ì—˜', 'ë¼í”¼ìŠ¤', 
            'ì•Œë¦¬ì‹œì•„', 'í…ŒíŠ¸ë¼', 'ì±„ì„ ', 'ê°¤ë¦¬ì˜¨', 'ë¯¸í›„ì™•'
        ].sort();

        // í˜„ì¬ ë‚˜ì˜ ì§„ì˜ê³¼ ìƒëŒ€í¸ ì§„ì˜ì— ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ ìˆ˜ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜
        let myPlacedSummoners = 0;
        let opponentPlacedSummoners = 0;

        // í˜„ì¬ ê° ì§„ì˜ì˜ ë¦¬ë” ì†Œí™˜ìˆ˜ ì—˜ë¦¬ë¨¼íŠ¸ (DOM ì°¸ì¡°)ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
        let myLeaderSummoner = null;
        let opponentLeaderSummoner = null;

        // í˜„ì¬ í™œì„±í™”ëœ í¸ì„± ë²ˆí˜¸
        let currentArrangementId = 1; 
        // í¸ì„± ëª©ë¡ (ì˜ˆ: [1, 2, 3])
        let availableArrangementIds = [];
        // í¸ì„± ì´ë¦„ ëª©ë¡ (ì˜ˆ: { "1": "ê³µê²©ë±" })
        let arrangementNames = {};

        // ë°°ì¹˜ ë³€ê²½ ì—¬ë¶€ í”Œë˜ê·¸
        let isDirty = false;

        // ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ íŒŒì¼ì˜ ê¸°ë³¸ ê²½ë¡œì™€ í™•ì¥ìë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
        const imagePath = 'summoner_images/'; // ì˜ˆ: 'summoner_images/' í´ë”ì— ì´ë¯¸ì§€ê°€ ìˆë‹¤ê³  ê°€ì •
        const imageExtension = '.png'; // ëª¨ë“  ì´ë¯¸ì§€ê°€ PNG í˜•ì‹ì´ë¼ê³  ê°€ì •

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ íƒ€ì„ì•„ì›ƒì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
        let toastTimeout;

        /**
         * 5x5 í¬ê¸°ì˜ ë°°ì¹˜ ê·¸ë¦¬ë“œ ì…€ë“¤ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         * ê° ì…€ì—ëŠ” ë“œë˜ê·¸ ì˜¤ë²„ ë° ë“œë¡­ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ë¦¬ìŠ¤ë„ˆê°€ ì¶”ê°€ë©ë‹ˆë‹¤.
         * @param {HTMLElement} gridElement - ì…€ë“¤ì´ ì¶”ê°€ë  ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ DOM ìš”ì†Œ (ì˜ˆ: myGrid, opponentGrid)
         * @param {string} gridType - ì´ ê·¸ë¦¬ë“œê°€ 'my' (ë‚˜ì˜ ì§„ì˜) ë˜ëŠ” 'opponent' (ìƒëŒ€í¸ ì§„ì˜) ì¤‘ ë¬´ì—‡ì¸ì§€ êµ¬ë¶„í•©ë‹ˆë‹¤.
         */
        function createGrid(gridElement, gridType) {
            gridElement.innerHTML = ''; // ê¸°ì¡´ ì…€ë“¤ì„ ì´ˆê¸°í™”
            for (let i = 0; i < grid5x5Size * grid5x5Size; i++) {
                const cell = document.createElement('div');
                cell.classList.add('grid-cell');
                cell.dataset.index = i; // ì…€ì˜ ìˆœì„œ ì¸ë±ìŠ¤ë¥¼ ë°ì´í„° ì†ì„±ìœ¼ë¡œ ì €ì¥
                gridElement.appendChild(cell);

                cell.addEventListener('dragover', dragOver); // ë“œë˜ê·¸ ì˜¤ë²„ ì‹œ í—ˆìš© ì²˜ë¦¬
                cell.addEventListener('drop', (e) => drop(e, gridType)); // ë“œë¡­ ì‹œ ì²˜ë¦¬
            }
        }

        /**
         * 17x9 í¬ê¸°ì˜ ì „ì¥ ê·¸ë¦¬ë“œ ì…€ë“¤ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         * ì „ì¥ ì…€ì˜ ì¤‘ì•™ ê³µìœ  ì˜ì—­ì— íŠ¹ë³„í•œ ë°°ê²½ ìŠ¤íƒ€ì¼ì„ ì ìš©í•©ë‹ˆë‹¤.
         */
        function createBattlefieldGrid() {
            battlefieldGrid.innerHTML = ''; // ê¸°ì¡´ ì…€ë“¤ì„ ì´ˆê¸°í™”
            for (let i = 0; i < battlefieldCols * battlefieldRows; i++) {
                const cell = document.createElement('div');
                cell.classList.add('battlefield-cell');
                const colIndex = i % battlefieldCols; // í˜„ì¬ ì…€ì˜ ì—´ ì¸ë±ìŠ¤
                // ë‚˜ì˜ ë¦¬ë” ì—´ê³¼ ìƒëŒ€ ë¦¬ë” ì—´ ì‚¬ì´ë¥¼ ê³µìœ  ì˜ì—­ìœ¼ë¡œ í‘œì‹œ
                if (colIndex > myLeaderBattlefieldCol && colIndex < opponentLeaderBattlefieldCol) { 
                     cell.classList.add('shared-column'); // ê³µìœ  ì˜ì—­ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ì¶”ê°€
                }
                battlefieldGrid.appendChild(cell);
            }
        }

        /**
         * ê³µìš© ì†Œí™˜ìˆ˜ í’€ì— ëª¨ë“  ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ ìš”ì†Œë“¤ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
         * ê° ì†Œí™˜ìˆ˜ëŠ” ë“œë˜ê·¸ ê°€ëŠ¥í•˜ë©°, í’€ì˜ ì†Œí™˜ìˆ˜ì—ê²ŒëŠ” ë¦¬ë”/ì œê±° ë²„íŠ¼ì´ ì—†ìŠµë‹ˆë‹¤.
         */
        function createCommonSummonerPool() {
            commonSummonersPool.innerHTML = ''; // ê¸°ì¡´ í’€ ë‚´ìš©ì„ ì´ˆê¸°í™”
            for (let i = 0; i < summonerNames.length; i++) { 
                const summoner = document.createElement('div');
                summoner.classList.add('summoner', 'summoner-draggable'); // ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ë“œë˜ê·¸ ê°€ëŠ¥ ìŠ¤íƒ€ì¼
                
                const img = document.createElement('img');
                img.src = `${imagePath}${summonerNames[i]}${imageExtension}`; // ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ ì„¤ì •
                img.alt = summonerNames[i]; // ì´ë¯¸ì§€ ëŒ€ì²´ í…ìŠ¤íŠ¸ (ì ‘ê·¼ì„±)
                summoner.appendChild(img);

                summoner.setAttribute('draggable', true); // HTML draggable ì†ì„± í™œì„±í™”
                summoner.id = `summoner-pool-${summonerNames[i]}`; // í’€ ë‚´ì—ì„œ ê³ ìœ í•œ ID ë¶€ì—¬
                summoner.dataset.summonerName = summonerNames[i]; // ì†Œí™˜ìˆ˜ ì´ë¦„ ë°ì´í„° ì†ì„± ì €ì¥
                summoner.dataset.isLeader = 'false'; // ì´ˆê¸° ë¦¬ë” ìƒíƒœ (í’€ì—ì„  ë¦¬ë” ì•„ë‹˜)
                commonSummonersPool.appendChild(summoner); // í’€ì— ì†Œí™˜ìˆ˜ ìš”ì†Œ ì¶”ê°€

                summoner.addEventListener('dragstart', dragStart); // ë“œë˜ê·¸ ì‹œì‘ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            }
        }

        /**
         * ë°°ì¹˜ ê·¸ë¦¬ë“œì— ìˆëŠ” ì†Œí™˜ìˆ˜ ìš”ì†Œì— 'L'(ë¦¬ë” ì§€ì •) ë° 'X'(ì œê±°) ë²„íŠ¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
         * ì´ ë²„íŠ¼ë“¤ì€ ì†Œí™˜ìˆ˜ê°€ í’€ì—ì„œ ê·¸ë¦¬ë“œë¡œ ë°°ì¹˜ë  ë•Œ ìƒì„±ë©ë‹ˆë‹¤.
         * @param {HTMLElement} summonerElement - ë²„íŠ¼ì„ ì¶”ê°€í•  ì†Œí™˜ìˆ˜ DOM ìš”ì†Œ
         */
        function addSummonerButtons(summonerElement) {
            // ë¦¬ë” ë²„íŠ¼ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
            let leaderBtn = summonerElement.querySelector('.leader-button');
            if (!leaderBtn) {
                leaderBtn = document.createElement('div');
                leaderBtn.classList.add('summoner-button', 'leader-button');
                leaderBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œë¡œ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                    toggleLeader(summonerElement); // ë¦¬ë” í† ê¸€ í•¨ìˆ˜ í˜¸ì¶œ
                });
                summonerElement.appendChild(leaderBtn);
            }
            // ë¦¬ë” ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ 'ğŸ‘‘' ë˜ëŠ” 'L'ë¡œ ë³€ê²½
            leaderBtn.textContent = (summonerElement.dataset.isLeader === 'true') ? 'ğŸ‘‘' : 'L'; 

            // ì œê±° ë²„íŠ¼ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
            let removeBtn = summonerElement.querySelector('.remove-button');
            if (!removeBtn) {
                removeBtn = document.createElement('div');
                removeBtn.classList.add('summoner-button', 'remove-button');
                removeBtn.textContent = 'X';
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œë¡œ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                    removeSummoner(summonerElement); // ì†Œí™˜ìˆ˜ ì œê±° í•¨ìˆ˜ í˜¸ì¶œ
                });
                summonerElement.appendChild(removeBtn);
            }
        }

        /**
         * ì†Œí™˜ìˆ˜ ìš”ì†Œì—ì„œ 'L' ë° 'X' ë²„íŠ¼ì„ ì œê±°í•©ë‹ˆë‹¤.
         * ì†Œí™˜ìˆ˜ê°€ ê·¸ë¦¬ë“œì—ì„œ ì œê±°ë˜ì–´ í’€ë¡œ ëŒì•„ê°ˆ ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
         * @param {HTMLElement} summonerElement - ë²„íŠ¼ì„ ì œê±°í•  ì†Œí™˜ìˆ˜ DOM ìš”ì†Œ
         */
        function removeSummonerButtons(summonerElement) {
            const leaderBtn = summonerElement.querySelector('.leader-button');
            if (leaderBtn) {
                leaderBtn.remove();
            }
            const removeBtn = summonerElement.querySelector('.remove-button');
            if (removeBtn) {
                removeBtn.remove();
            }
        }

        // í˜„ì¬ ë“œë˜ê·¸ ì¤‘ì¸ ì†Œí™˜ìˆ˜ ì—˜ë¦¬ë¨¼íŠ¸ (ì›ë³¸ í’€ ì†Œí™˜ìˆ˜, ë°°ì¹˜ëœ í´ë¡  ì†Œí™˜ìˆ˜, ì „ì¥ ì†Œí™˜ìˆ˜)
        let draggedSummoner = null; 
        // ë“œë˜ê·¸ ì‹œì‘ ì‹œ, ë°°ì¹˜ ê·¸ë¦¬ë“œì— ìˆë˜ ì†Œí™˜ìˆ˜(í´ë¡ )ì˜ ì›ë˜ ì…€ (HTMLElement)ì„ ì¶”ì í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
        let originalDragSourceCell = null; 

        /**
         * ë“œë˜ê·¸ ì‘ì—…ì´ ì‹œì‘ë  ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
         * ë“œë˜ê·¸ ëŒ€ìƒ ì†Œí™˜ìˆ˜ì˜ ìœ í˜•ì„ ì‹ë³„í•˜ê³ , ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ì¼ ê²½ìš° ì„ì‹œë¡œ DOMì—ì„œ ì œê±°í•©ë‹ˆë‹¤.
         * @param {Event} e - dragstart ì´ë²¤íŠ¸ ê°ì²´
         */
        function dragStart(e) {
            draggedSummoner = e.target;
            
            // ë§Œì•½ ë“œë˜ê·¸ ëŒ€ìƒì´ ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ ìì²´ì¼ ê²½ìš°, ë¶€ëª¨ ì†Œí™˜ìˆ˜ divë¥¼ ì‹¤ì œ ë“œë˜ê·¸ ëŒ€ìƒìœ¼ë¡œ ì„¤ì •
            if (draggedSummoner.tagName === 'IMG') {
                draggedSummoner = draggedSummoner.closest('.summoner, .battlefield-summoner.my-summoner');
                if (!draggedSummoner) return; // ìœ íš¨í•œ ì†Œí™˜ìˆ˜ divë¥¼ ì°¾ì§€ ëª»í•˜ë©´ í•¨ìˆ˜ ì¢…ë£Œ
            }

            // ë“œë˜ê·¸í•˜ëŠ” ì†Œí™˜ìˆ˜ê°€ í’€ì— ìˆëŠ” ì›ë³¸ì¸ì§€, ê·¸ë¦¬ë“œì— ë°°ì¹˜ëœ í´ë¡ ì¸ì§€ êµ¬ë¶„
            if (draggedSummoner.parentElement.id === 'common-summoners-pool') {
                draggedSummoner.dataset.isPoolOriginal = 'true'; // í’€ì—ì„œ ì˜¨ ì›ë³¸ ì†Œí™˜ìˆ˜
                originalDragSourceCell = null; // í’€ì—ì„œ ì™”ìœ¼ë¯€ë¡œ ì›ë˜ ë°°ì¹˜ ì…€ ì—†ìŒ
            } 
            else { 
                draggedSummoner.dataset.isPoolOriginal = 'false'; // ê·¸ë¦¬ë“œì—ì„œ ì˜¨ í´ë¡  ì†Œí™˜ìˆ˜
                // ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ë¥¼ ë“œë˜ê·¸í•  ê²½ìš°, ì›ë˜ ìˆë˜ ì…€ì„ ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ë³µêµ¬ ë˜ëŠ” êµí™˜ì— ì‚¬ìš©
                originalDragSourceCell = draggedSummoner.parentElement;
            }

            // 0.5ì´ˆ í›„ ë“œë˜ê·¸ ì¤‘ì¸ ì†Œí™˜ìˆ˜ë¥¼ ë°˜íˆ¬ëª…í•˜ê²Œ ë§Œë“¤ê³ , ì›ë˜ ì…€ì—ì„œ ì„ì‹œ ì œê±°
            setTimeout(() => {
                draggedSummoner.style.opacity = '0.5';
                
                // ê·¸ë¦¬ë“œì—ì„œ ì˜¨ ì†Œí™˜ìˆ˜ì¼ ê²½ìš°ì—ë§Œ ì›ë˜ ì…€ì—ì„œ ì œê±°í•˜ì—¬ ë“œë¡­ ê³µê°„ì„ ë¹„ì›Œì¤Œ
                if (originalDragSourceCell) { 
                    originalDragSourceCell.removeChild(draggedSummoner);
                }
            }, 0);
        }

        /**
         * ë“œë˜ê·¸ ì¤‘ì¸ ìš”ì†Œê°€ ë“œë¡­ ê°€ëŠ¥í•œ ëŒ€ìƒ ìœ„ë¡œ ì´ë™í•  ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
         * ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ ë“œë¡­ ë™ì‘ì„ ë°©ì§€í•˜ì—¬ ë“œë¡­ì„ í—ˆìš©í•©ë‹ˆë‹¤.
         * @param {Event} e - dragover ì´ë²¤íŠ¸ ê°ì²´
         */
        function dragOver(e) {
            e.preventDefault(); 
        }

        /**
         * ë“œë˜ê·¸ ì¤‘ì¸ ìš”ì†Œê°€ ë“œë¡­ ëŒ€ìƒ ìœ„ì— ë†“ì¼ ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
         * ì†Œí™˜ìˆ˜ ë°°ì¹˜, ì´ë™, êµí™˜, ì œê±° ë“±ì˜ ë³µì¡í•œ ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
         * @param {Event} e - drop ì´ë²¤íŠ¸ ê°ì²´
         * @param {string} targetGridType - ë“œë¡­ ëŒ€ìƒ ê·¸ë¦¬ë“œì˜ ìœ í˜• ('my' ë˜ëŠ” 'opponent')
         */
        function drop(e, targetGridType) {
            e.preventDefault(); 
            if (!draggedSummoner) return; // ìœ íš¨í•œ ë“œë˜ê·¸ ëŒ€ìƒì´ ì—†ìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ

            const targetCell = e.target.closest('.grid-cell'); // ë“œë¡­ëœ ê³³ì´ ê·¸ë¦¬ë“œ ì…€ì¸ì§€ í™•ì¸
            const draggedIsPoolOriginal = draggedSummoner.dataset.isPoolOriginal === 'true'; // ë“œë˜ê·¸ ëŒ€ìƒì´ í’€ì˜ ì›ë³¸ì¸ì§€ ì—¬ë¶€

            // 1. ë“œë¡­ ëŒ€ìƒì´ ê·¸ë¦¬ë“œ ì…€ì´ ì•„ë‹Œ ê³³ì¸ ê²½ìš° (ì†Œí™˜ìˆ˜ ì œê±° ë˜ëŠ” ì›ë³¸ ë³µêµ¬)
            if (!targetCell) { 
                if (!draggedIsPoolOriginal) { // ë°°ì¹˜ëœ í´ë¡  ì†Œí™˜ìˆ˜ë¥¼ ê·¸ë¦¬ë“œ ë°–ìœ¼ë¡œ ë“œë¡­í•œ ê²½ìš°
                    removeSummonerFromGrid(draggedSummoner); // ë°°ì¹˜ ìˆ˜ ê°ì†Œ ë° ë¦¬ë” í•´ì œ (DOM ì œê±°ëŠ” ì´ í•¨ìˆ˜ì—ì„œ í•˜ì§€ ì•ŠìŒ)
                    draggedSummoner.remove(); // í´ë¡ ì´ë¯€ë¡œ DOMì—ì„œ ì™„ì „íˆ ì œê±°
                } else { // í’€ì˜ ì›ë³¸ ì†Œí™˜ìˆ˜ë¥¼ ê·¸ë¦¬ë“œ ë°–ìœ¼ë¡œ ë“œë¡­í•œ ê²½ìš° (í’€ë¡œ ëŒì•„ê°€ì•¼ í•¨)
                    draggedSummoner.style.opacity = '1'; // íˆ¬ëª…ë„ ë³µêµ¬
                    draggedSummoner.removeAttribute('data-is-pool-original'); // ì„ì‹œ ë°ì´í„° ì œê±°
                }
                // ë“œë¡­ ê²°ê³¼ì— ë”°ë¥¸ UI ë° ì „ì¥ ì—…ë°ì´íŠ¸
                draggedSummoner = null;
                originalDragSourceCell = null; // ì›ë˜ ì…€ ì •ë³´ ì´ˆê¸°í™”
                updateLeaderMarkers();
                updatePlacementCountDisplays(); // N/15 ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                updateBattlefield(); // ì „ì¥ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
                isDirty = true; // ë³€ê²½ì‚¬í•­ ë°œìƒ
                return; // í•¨ìˆ˜ ì¢…ë£Œ
            }
            
            const willBeOpponent = (targetGridType === 'opponent'); // ë“œë¡­ë  ê·¸ë¦¬ë“œì˜ ì§„ì˜
            let summonerToPlace = draggedSummoner; // ìµœì¢…ì ìœ¼ë¡œ íƒ€ê²Ÿ ì…€ì— ë°°ì¹˜ë  ì†Œí™˜ìˆ˜ ì—˜ë¦¬ë¨¼íŠ¸

            // 2. í’€ì—ì„œ ê·¸ë¦¬ë“œë¡œ ìƒˆë¡œìš´ ì†Œí™˜ìˆ˜ë¥¼ ë°°ì¹˜í•˜ëŠ” ê²½ìš° (ë“œë˜ê·¸ ëŒ€ìƒì´ í’€ì˜ ì›ë³¸)
            if (draggedIsPoolOriginal) { 
                const currentPlacedCount = willBeOpponent ? opponentPlacedSummoners : myPlacedSummoners;
                if (currentPlacedCount >= maxSummoners) { // í•´ë‹¹ ì§„ì˜ì˜ ìµœëŒ€ ë°°ì¹˜ ìˆ˜ ì´ˆê³¼ í™•ì¸
                    showToast(`ë” ì´ìƒ ì†Œí™˜ìˆ˜ë¥¼ ë°°ì¹˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ìµœëŒ€ ${maxSummoners}ë§ˆë¦¬)`);
                    draggedSummoner.style.opacity = '1';
                    draggedSummoner.removeAttribute('data-is-pool-original');
                    draggedSummoner = null;
                    return;
                }

                // ë™ì¼ ê·¸ë¦¬ë“œ ë‚´ ê°™ì€ ì†Œí™˜ìˆ˜ ì¤‘ë³µ ë°°ì¹˜ ê¸ˆì§€
                const targetGrid = targetGridType === 'my' ? myGrid : opponentGrid;
                const existingSummonerNamesInGrid = Array.from(targetGrid.querySelectorAll('.summoner.is-placed')).map(s => s.dataset.summonerName);
                if (existingSummonerNamesInGrid.includes(draggedSummoner.dataset.summonerName)) {
                    showToast(`"${draggedSummoner.dataset.summonerName}" ì†Œí™˜ìˆ˜ëŠ” ì´ë¯¸ ì´ ê·¸ë¦¬ë“œì— ë°°ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);
                    draggedSummoner.style.opacity = '1';
                    draggedSummoner.removeAttribute('data-is-pool-original');
                    draggedSummoner = null;
                    return;
                }
                
                // ìƒˆë¡œìš´ í´ë¡  ìƒì„± ë° ì†ì„± ì„¤ì •
                summonerToPlace = draggedSummoner.cloneNode(true); // ì›ë³¸ ì†Œí™˜ìˆ˜ë¡œë¶€í„° í´ë¡  ìƒì„±
                summonerToPlace.classList.remove('summoner-draggable');
                summonerToPlace.classList.add('is-placed'); // ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ì„ì„ í‘œì‹œ
                summonerToPlace.removeAttribute('id'); // í´ë¡ ì´ë¯€ë¡œ ID ì œê±° (HTML IDëŠ” ê³ ìœ í•´ì•¼ í•¨)
                summonerToPlace.setAttribute('draggable', true); // í´ë¡ ë„ ë“œë˜ê·¸ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
                summonerToPlace.addEventListener('dragstart', dragStart); // í´ë¡ ì— dragstart ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì—°ê²°
                summonerToPlace.dataset.isLeader = 'false'; // ìƒˆë¡œ ë°°ì¹˜ë˜ëŠ” ì†Œí™˜ìˆ˜ëŠ” ì´ˆê¸° ë¦¬ë” ì•„ë‹˜
                summonerToPlace.dataset.isOpponent = willBeOpponent.toString(); // ì§„ì˜ ì„¤ì •
                
                // ìƒˆë¡œìš´ ë°°ì¹˜ì´ë¯€ë¡œ í•´ë‹¹ ì§„ì˜ì˜ ì†Œí™˜ìˆ˜ ì¹´ìš´íŠ¸ ì¦ê°€
                if (willBeOpponent) {
                    opponentPlacedSummoners++;
                } else {
                    myPlacedSummoners++;
                }

                draggedSummoner.style.opacity = '1'; // ì›ë³¸ ì†Œí™˜ìˆ˜ íˆ¬ëª…ë„ ë³µêµ¬
                draggedSummoner.removeAttribute('data-is-pool-original'); // ì„ì‹œ ë°ì´í„° ì œê±°

            } else { // 3. ê·¸ë¦¬ë“œì—ì„œ ê·¸ë¦¬ë“œë¡œ ì´ë™ ë˜ëŠ” êµí™˜ (ë“œë˜ê·¸ ëŒ€ìƒì´ ì´ë¯¸ ë°°ì¹˜ëœ í´ë¡  ì†Œí™˜ìˆ˜)
                const draggedSummonerIsOpponent = summonerToPlace.dataset.isOpponent === 'true'; // ë“œë˜ê·¸í•œ ì†Œí™˜ìˆ˜ì˜ í˜„ì¬ ì§„ì˜
                const originalGridWasOpponent = (originalDragSourceCell && originalDragSourceCell.parentElement.id === 'opponent-grid'); // ë“œë˜ê·¸ ì „ ì†Œí™˜ìˆ˜ì˜ ì§„ì˜
                
                // ëŒ€ìƒ ì…€ì— ì´ë¯¸ ì†Œí™˜ìˆ˜ê°€ ìˆëŠ” ê²½ìš° (êµí™˜)
                if (targetCell.hasChildNodes()) { 
                    const existingSummoner = targetCell.firstChild; // ëŒ€ìƒ ì…€ì˜ ê¸°ì¡´ ì†Œí™˜ìˆ˜
                    const existingIsOpponent = existingSummoner.dataset.isOpponent === 'true'; // ê¸°ì¡´ ì†Œí™˜ìˆ˜ì˜ ì§„ì˜

                    if (draggedSummonerIsOpponent === existingIsOpponent) { // ê°™ì€ ì§„ì˜ ì†Œí™˜ìˆ˜ë¼ë¦¬ë§Œ êµí™˜ í—ˆìš©
                        // ê¸°ì¡´ ì†Œí™˜ìˆ˜(existingSummoner)ë¥¼ ë“œë˜ê·¸í•œ ì†Œí™˜ìˆ˜(summonerToPlace)ì˜ ì›ë˜ ìœ„ì¹˜ë¡œ ì˜®ê¹€
                        if (originalDragSourceCell) { // dragStart ì‹œ ì›ë˜ ì…€ì´ ì €ì¥ë˜ì–´ ìˆë‹¤ë©´
                             originalDragSourceCell.appendChild(existingSummoner); // ê¸°ì¡´ ì†Œí™˜ìˆ˜ë¥¼ ì›ë˜ ìë¦¬ë¡œ ì´ë™
                             existingSummoner.style.opacity = '1'; // íˆ¬ëª…ë„ ë³µêµ¬
                             addSummonerButtons(existingSummoner); // ë²„íŠ¼ ë‹¤ì‹œ ì¶”ê°€
                        } else { // ì›ë˜ ì…€ì„ ì°¾ì„ ìˆ˜ ì—†ëŠ” ë¹„ìƒ ìƒí™© (ë°œìƒí•´ì„œëŠ” ì•ˆë˜ì§€ë§Œ, ì•ˆì „ì¥ì¹˜)
                            // ì´ ê²½ìš°ëŠ” êµí™˜ì´ ì•„ë‹ˆë¯€ë¡œ, ê¸°ì¡´ ì†Œí™˜ìˆ˜ëŠ” ì œê±°í•˜ê³  ì¹´ìš´íŠ¸ë¥¼ ì¤„ì—¬ì•¼ í•¨
                            removeSummonerFromGrid(existingSummoner); // ì¹´ìš´íŠ¸ ê°ì†Œ, ë¦¬ë” í•´ì œ (existingSummonerëŠ” ì‚¬ë¼ì§)
                            existingSummoner.remove(); // DOMì—ì„œ ì œê±°
                        }
                        // êµí™˜ì´ë¯€ë¡œ ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ ì´ ê°œìˆ˜ì—ëŠ” ë³€ê²½ ì—†ìŒ.
                    } else { // ë‹¤ë¥¸ ì§„ì˜ ì†Œí™˜ìˆ˜ì™€ëŠ” êµí™˜ ë¶ˆê°€
                        showToast('ë‹¤ë¥¸ ì§„ì˜ì˜ ì†Œí™˜ìˆ˜ì™€ëŠ” êµí™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        // ë“œë˜ê·¸í•œ ì†Œí™˜ìˆ˜(summonerToPlace)ë¥¼ ì›ë˜ ìœ„ì¹˜(originalDragSourceCell)ë¡œ ë³µêµ¬
                        if (originalDragSourceCell) { // dragStart ì‹œ ì›ë˜ ì…€ì´ ì €ì¥ë˜ì–´ ìˆë‹¤ë©´
                             originalDragSourceCell.appendChild(summonerToPlace);
                        }
                        summonerToPlace.style.opacity = '1'; // íˆ¬ëª…ë„ ë³µêµ¬
                        addSummonerButtons(summonerToPlace); // ë²„íŠ¼ ë‹¤ì‹œ ì¶”ê°€
                        // ë“œë¡­ ì‹¤íŒ¨ ì‹œ ë³€ìˆ˜ ì´ˆê¸°í™” ë° UI ì—…ë°ì´íŠ¸ í›„ í•¨ìˆ˜ ì¢…ë£Œ
                        draggedSummoner = null;
                        originalDragSourceCell = null;
                        updateLeaderMarkers();
                        updatePlacementCountDisplays();
                        updateBattlefield();
                        return; // êµí™˜ ì‹¤íŒ¨ ì‹œ í•¨ìˆ˜ ì¢…ë£Œ
                    }
                } else { // ëŒ€ìƒ ì…€ì´ ë¹ˆ ê²½ìš° (ì´ë™)
                    // ì§„ì˜ ë³€ê²½ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì†Œí™˜ìˆ˜ ì¹´ìš´íŠ¸ ë° ë¦¬ë” ì •ë³´ ì—…ë°ì´íŠ¸ (ê°™ì€ ê·¸ë¦¬ë“œ ë‚´ ì´ë™ì€ ì¹´ìš´íŠ¸ ë¶ˆë³€)
                    if (originalGridWasOpponent !== willBeOpponent) { 
                        if (originalGridWasOpponent) { // ìƒëŒ€ ê·¸ë¦¬ë“œì—ì„œ ë‚˜ì˜ ê·¸ë¦¬ë“œë¡œ ì´ë™
                            opponentPlacedSummoners--;
                            myPlacedSummoners++;
                        } else { // ë‚˜ì˜ ê·¸ë¦¬ë“œì—ì„œ ìƒëŒ€ ê·¸ë¦¬ë“œë¡œ ì´ë™
                            myPlacedSummoners--;
                            opponentPlacedSummoners++;
                        }
                        // ë¦¬ë”ë„ í•´ë‹¹ ì§„ì˜ì—ì„œ í•´ì œ (ì´ë™í•œ ì†Œí™˜ìˆ˜ê°€ ë¦¬ë”ì˜€ë‹¤ë©´)
                        if (opponentLeaderSummoner === summonerToPlace) opponentLeaderSummoner = null;
                        if (myLeaderSummoner === summonerToPlace) myLeaderSummoner = null;
                        
                        summonerToPlace.classList.remove('is-leader'); // ë¦¬ë” ìƒíƒœ í´ë˜ìŠ¤ ì œê±°
                        summonerToPlace.dataset.isLeader = 'false'; // ë¦¬ë” ë°ì´í„° ì†ì„± ì—…ë°ì´íŠ¸
                    }
                }
                // ë“œë˜ê·¸í•œ ì†Œí™˜ìˆ˜ì˜ ì†Œìœ ì ì—…ë°ì´íŠ¸ (ì§„ì˜ ë³€ê²½ì´ ìˆì—ˆë‹¤ë©´)
                summonerToPlace.dataset.isOpponent = willBeOpponent.toString(); 
            }

            // ìµœì¢…ì ìœ¼ë¡œ ëª¨ë“  ë“œë¡­ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì„±ê³µì ì¸ ëì—ì„œ ì†Œí™˜ìˆ˜ë¥¼ íƒ€ê²Ÿ ì…€ì— ì¶”ê°€
            targetCell.appendChild(summonerToPlace);
            summonerToPlace.style.opacity = '1'; // íˆ¬ëª…ë„ ë³µêµ¬
            addSummonerButtons(summonerToPlace); // ë²„íŠ¼ ë‹¤ì‹œ ì¶”ê°€

            // ëª¨ë“  ë“œë¡­ ì‹œë‚˜ë¦¬ì˜¤ ì²˜ë¦¬ ì™„ë£Œ í›„ ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” ë° UI ì—…ë°ì´íŠ¸
            draggedSummoner = null;
            originalDragSourceCell = null; 
            updateLeaderMarkers();
            updatePlacementCountDisplays(); // N/15 ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            updateBattlefield(); // ì „ì¥ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
            isDirty = true; // ë³€ê²½ì‚¬í•­ ë°œìƒ
        }

        /**
         * ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ë¥¼ ê·¸ë¦¬ë“œì—ì„œ ì œê±°í•˜ê³  í’€ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.
         * ì£¼ë¡œ 'X' ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
         * @param {HTMLElement} summonerElement - ì œê±°í•  ì†Œí™˜ìˆ˜ DOM ìš”ì†Œ (í´ë¡ )
         */
        function removeSummoner(summonerElement) {
            const parentCell = summonerElement.parentElement;
            if (parentCell && parentCell.classList.contains('grid-cell')) { // ì†Œí™˜ìˆ˜ê°€ ê·¸ë¦¬ë“œ ì…€ì— ì‹¤ì œë¡œ ìˆë‹¤ë©´
                removeSummonerFromGrid(summonerElement); // ë°°ì¹˜ ìˆ˜ ê°ì†Œ ë° ë¦¬ë” ì •ë³´ ì—…ë°ì´íŠ¸
                summonerElement.remove(); // í´ë¡ ì´ë¯€ë¡œ DOMì—ì„œ ì™„ì „íˆ ì œê±°
                
                // ì œê±° í›„ UI ì—…ë°ì´íŠ¸
                updateLeaderMarkers();
                updatePlacementCountDisplays(); // N/15 ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                updateBattlefield(); // ì „ì¥ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
                isDirty = true; // ë³€ê²½ì‚¬í•­ ë°œìƒ
            }
        }

        /**
         * ê·¸ë¦¬ë“œì—ì„œ ì†Œí™˜ìˆ˜(í´ë¡ )ê°€ ì™„ì „íˆ ì œê±°ë  ë•Œ í˜¸ì¶œë˜ì–´ ë°°ì¹˜ ìˆ˜ ë° ë¦¬ë” ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * (DOMì—ì„œ ì‹¤ì œ ìš”ì†Œë¥¼ ì œê±°í•˜ëŠ” ì—­í• ì€ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê³³ì—ì„œ ìˆ˜í–‰í•©ë‹ˆë‹¤.)
         * @param {HTMLElement} summonerElement - ì œê±°ë  ì†Œí™˜ìˆ˜ DOM ìš”ì†Œ
         */
        function removeSummonerFromGrid(summonerElement) {
            const isOpponent = summonerElement.dataset.isOpponent === 'true';
            if (isOpponent) { // ìƒëŒ€í¸ ì†Œí™˜ìˆ˜ë¼ë©´
                opponentPlacedSummoners--; // ìƒëŒ€í¸ ë°°ì¹˜ ìˆ˜ ê°ì†Œ
                if (opponentLeaderSummoner === summonerElement) { // ì œê±°ë˜ëŠ” ì†Œí™˜ìˆ˜ê°€ ë¦¬ë”ì˜€ë‹¤ë©´
                    opponentLeaderSummoner = null; // ë¦¬ë” í•´ì œ
                }
            } else { // ë‚˜ì˜ ì†Œí™˜ìˆ˜ë¼ë©´
                myPlacedSummoners--; // ë‚˜ì˜ ë°°ì¹˜ ìˆ˜ ê°ì†Œ
                if (myLeaderSummoner === summonerElement) { // ì œê±°ë˜ëŠ” ì†Œí™˜ìˆ˜ê°€ ë¦¬ë”ì˜€ë‹¤ë©´
                    myLeaderSummoner = null; // ë¦¬ë” í•´ì œ
                }
            }
            summonerElement.dataset.isLeader = 'false'; // ë°ì´í„° ì†ì„±ë„ ë¦¬ë” í•´ì œë¡œ ì—…ë°ì´íŠ¸
        }

        /**
         * ì†Œí™˜ìˆ˜ë¥¼ í•´ë‹¹ ì§„ì˜ì˜ ë¦¬ë”ë¡œ ì§€ì •í•˜ê±°ë‚˜, ì´ë¯¸ ë¦¬ë”ì¸ ê²½ìš° í•´ì œí•©ë‹ˆë‹¤.
         * 'L' ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
         * @param {HTMLElement} summonerElement - ë¦¬ë” ìƒíƒœë¥¼ ë³€ê²½í•  ì†Œí™˜ìˆ˜ DOM ìš”ì†Œ
         */
        function toggleLeader(summonerElement) {
            const isOpponent = summonerElement.dataset.isOpponent === 'true';
            let currentLeader = isOpponent ? opponentLeaderSummoner : myLeaderSummoner;

            // ì†Œí™˜ìˆ˜ê°€ ê·¸ë¦¬ë“œì— ë°°ì¹˜ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ ë¦¬ë” ì§€ì • ë¶ˆê°€
            if (!summonerElement.parentElement.classList.contains('grid-cell')) {
                return; 
            }

            if (summonerElement.dataset.isLeader === 'true') {
                // ì´ë¯¸ ë¦¬ë”ì¸ ê²½ìš°: ë¦¬ë” ìƒíƒœë¥¼ í•´ì œí•©ë‹ˆë‹¤.
                summonerElement.dataset.isLeader = 'false';
                if (isOpponent) {
                    opponentLeaderSummoner = null;
                } else {
                    myLeaderSummoner = null;
                }
            } else {
                // ë¦¬ë”ê°€ ì•„ë‹Œ ê²½ìš°: í•´ë‹¹ ì†Œí™˜ìˆ˜ë¥¼ ë¦¬ë”ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
                // ì´ì „ì— ë¦¬ë”ì˜€ë˜ ì†Œí™˜ìˆ˜ê°€ ìˆë‹¤ë©´ ê·¸ ì†Œí™˜ìˆ˜ì˜ ë¦¬ë” ìƒíƒœë¥¼ í•´ì œí•©ë‹ˆë‹¤.
                if (currentLeader) {
                    currentLeader.dataset.isLeader = 'false'; // ê¸°ì¡´ ë¦¬ë” í•´ì œ
                }
                summonerElement.dataset.isLeader = 'true'; // ìƒˆ ì†Œí™˜ìˆ˜ë¥¼ ë¦¬ë”ë¡œ ì„¤ì •
                if (isOpponent) {
                    opponentLeaderSummoner = summonerElement;
                } else {
                    myLeaderSummoner = summonerElement;
                }
            }
            // ë¦¬ë” ìƒíƒœ ë³€ê²½ í›„ UI ì—…ë°ì´íŠ¸
            updateLeaderMarkers(); // ë¦¬ë” ë§ˆì»¤(ì™•ê´€/L) ì—…ë°ì´íŠ¸
            updateBattlefield(); // ì „ì¥ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸ (ë¦¬ë” ìœ„ì¹˜ ë°˜ì˜)
            isDirty = true; // ë³€ê²½ì‚¬í•­ ë°œìƒ
        }

        /**
         * ë°°ì¹˜ ê·¸ë¦¬ë“œì— ìˆëŠ” ì†Œí™˜ìˆ˜ë“¤ì˜ ë¦¬ë” í‘œì‹œ (í…Œë‘ë¦¬, ë²„íŠ¼ í…ìŠ¤íŠ¸)ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateLeaderMarkers() {
            // ëª¨ë“  ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ì—ì„œ ë¦¬ë” í…Œë‘ë¦¬ ì œê±° ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ 'L'ë¡œ ì´ˆê¸°í™”
            document.querySelectorAll('.grid-cell .summoner').forEach(s => {
                s.classList.remove('is-leader'); // ë¦¬ë” í…Œë‘ë¦¬ í´ë˜ìŠ¤ ì œê±°

                const leaderBtn = s.querySelector('.leader-button');
                if (leaderBtn) {
                    leaderBtn.textContent = 'L'; // ê¸°ë³¸ 'L' í…ìŠ¤íŠ¸ë¡œ ë³µêµ¬
                }
            });

            // í˜„ì¬ ë¦¬ë”ë¡œ ì§€ì •ëœ ì†Œí™˜ìˆ˜ì—ê²Œ ë¦¬ë” í…Œë‘ë¦¬ ì¶”ê°€ ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ 'ğŸ‘‘'ìœ¼ë¡œ ë³€ê²½
            [myLeaderSummoner, opponentLeaderSummoner].forEach(leader => {
                // ë¦¬ë”ê°€ ì¡´ì¬í•˜ê³  ì•„ì§ ë°°ì¹˜ ê·¸ë¦¬ë“œì— ìˆë‹¤ë©´ (ìœ íš¨ì„± ê²€ì‚¬)
                if (leader && leader.parentElement && leader.parentElement.classList.contains('grid-cell')) {
                    leader.classList.add('is-leader'); // ë¦¬ë” í…Œë‘ë¦¬ í´ë˜ìŠ¤ ì¶”ê°€
                    const leaderBtn = leader.querySelector('.leader-button');
                    if (leaderBtn) {
                        leaderBtn.textContent = 'ğŸ‘‘'; // ì™•ê´€ ì´ëª¨ì§€ë¡œ ë³€ê²½
                    }
                }
            });
        }

        /**
         * ë°°ì¹˜ ìˆ˜ UI (N/15)ë¥¼ í˜„ì¬ ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ ìˆ˜ì— ë§ì¶° ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updatePlacementCountDisplays() {
            myGridCountDisplay.textContent = `${myPlacedSummoners}/${maxSummoners}`;
            opponentGridCountDisplay.textContent = `${opponentPlacedSummoners}/${maxSummoners}`;
        }

        /**
         * ì „ì¥ ê·¸ë¦¬ë“œë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ í˜„ì¬ ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ë“¤ì„ ì •í™•í•œ ìœ„ì¹˜ì— í‘œì‹œí•©ë‹ˆë‹¤.
         * ì†Œí™˜ìˆ˜ ê°œìˆ˜ì— ë”°ë¼ ì „ì¥ ì…€ì˜ ë‚´ë¶€ ê·¸ë¦¬ë“œ í…œí”Œë¦¿ê³¼ ì†Œí™˜ìˆ˜ í¬ê¸°ê°€ ë™ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.
         */
        function updateBattlefield() {
            battlefieldGrid.innerHTML = ''; // ê¸°ì¡´ ì „ì¥ ê·¸ë¦¬ë“œ ë‚´ìš©ì„ ëª¨ë‘ ì§€ì›€
            createBattlefieldGrid(); // ë¹„ì–´ìˆëŠ” ì „ì¥ ê·¸ë¦¬ë“œ ì…€ë“¤ì„ ë‹¤ì‹œ ìƒì„±

            const battlefieldCells = battlefieldGrid.querySelectorAll('.battlefield-cell');
            
            // ì „ì¥ ì¤‘ì•™ì˜ ê³µìœ  ì˜ì—­ ì…€ì— ë°°ê²½ìƒ‰ì„ ë‹¤ì‹œ ì ìš©
            for (let r = 0; r < battlefieldRows; r++) {
                for (let c = myLeaderBattlefieldCol + 1; c < opponentLeaderBattlefieldCol; c++) { 
                     const battlefieldIndex = r * battlefieldCols + c;
                     if (battlefieldCells[battlefieldIndex]) {
                         battlefieldCells[battlefieldIndex].classList.add('shared-column');
                     }
                }
            }

            // ë‚˜ì˜ ë°°ì¹˜ ê·¸ë¦¬ë“œì™€ ìƒëŒ€í¸ ë°°ì¹˜ ê·¸ë¦¬ë“œì—ì„œ ì†Œí™˜ìˆ˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
            const myPlacedSummonersData = collectSummonersData(myGrid);
            const opponentPlacedSummonersData = collectSummonersData(opponentGrid);

            // ê° ì§„ì˜ì˜ ë¦¬ë” ì†Œí™˜ìˆ˜ì˜ ì›ë˜ ë°°ì¹˜ ê·¸ë¦¬ë“œ ë‚´ ìœ„ì¹˜ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
            let myLeaderOriginalPos = myPlacedSummonersData.find(s => s.isLeader);
            let opponentLeaderOriginalPos = opponentPlacedSummonersData.find(s => s.isLeader);

            // ì „ì¥ ì…€ë³„ë¡œ ë°°ì¹˜ë  ì†Œí™˜ìˆ˜ë“¤ì„ ë§¤í•‘í•˜ê¸° ìœ„í•œ Map (ì˜ˆ: "í–‰,ì—´" ë¬¸ìì—´ í‚¤ì— ì†Œí™˜ìˆ˜ ì—˜ë¦¬ë¨¼íŠ¸ ë°°ì—´ ì €ì¥)
            const battlefieldPlacementMap = new Map();

            // ë‚˜ì˜ ì†Œí™˜ìˆ˜ë“¤ì„ ì „ì¥ ì¢Œí‘œì— ë§¤í•‘í•˜ì—¬ Mapì— ì¶”ê°€
            // ë¦¬ë”ê°€ ì¡´ì¬í•˜ê³  ë°°ì¹˜ë˜ì–´ ìˆë‹¤ë©´, ë¨¼ì € ë¦¬ë”ë¥¼ ì „ì¥ ì¤‘ì•™ ì—´ì— ë§¤í•‘í•©ë‹ˆë‹¤.
            if (myLeaderSummoner && myLeaderSummoner.parentElement && myLeaderSummoner.parentElement.classList.contains('grid-cell')) {
                const key = `${battlefieldVerticalCenterRow},${myLeaderBattlefieldCol}`;
                if (!battlefieldPlacementMap.has(key)) battlefieldPlacementMap.set(key, []);
                battlefieldPlacementMap.get(key).push(myLeaderSummoner);
            }
            // ë¦¬ë”ê°€ ì•„ë‹Œ ë‚˜ì˜ ë‹¤ë¥¸ ì†Œí™˜ìˆ˜ë“¤ì„ ë¦¬ë”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒëŒ€ì ìœ¼ë¡œ ì „ì¥ ì¢Œí‘œì— ë§¤í•‘í•©ë‹ˆë‹¤.
            myPlacedSummonersData.forEach(data => {
                if (!data.isLeader) { // ë¦¬ë”ëŠ” ìœ„ì—ì„œ ì´ë¯¸ ì²˜ë¦¬í–ˆìœ¼ë¯€ë¡œ ê±´ë„ˆëœë‹ˆë‹¤.
                    let bfRow, bfCol;
                    if (myLeaderOriginalPos) { // ë¦¬ë”ê°€ ìˆì„ ê²½ìš°: ë¦¬ë”ì˜ ì „ì¥ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒëŒ€ì  ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                        const rowDiff = data.originalRow - myLeaderOriginalPos.originalRow;
                        const colDiff = data.originalCol - myLeaderOriginalPos.originalCol;
                        bfRow = battlefieldVerticalCenterRow + rowDiff;
                        bfCol = myLeaderBattlefieldCol + colDiff;
                    } else { // ë¦¬ë”ê°€ ì—†ì„ ê²½ìš°: ë‚˜ì˜ ê·¸ë¦¬ë“œ ì‹œì‘ì  (ì „ì¥ 2í–‰, 0ì—´) ê¸°ì¤€ìœ¼ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.
                        bfRow = battlefieldVerticalCenterRow - 2 + data.originalRow;
                        bfCol = 0 + data.originalCol; 
                    }
                    // ê³„ì‚°ëœ ì „ì¥ ì¢Œí‘œê°€ ìœ íš¨í•œ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸ í›„ Mapì— ì¶”ê°€í•©ë‹ˆë‹¤.
                    if (bfRow >= 0 && bfRow < battlefieldRows && bfCol >= 0 && bfCol < battlefieldCols) {
                        const key = `${bfRow},${bfCol}`;
                        if (!battlefieldPlacementMap.has(key)) battlefieldPlacementMap.set(key, []);
                        battlefieldPlacementMap.get(key).push(data.summoner);
                    }
                }
            });

            // ìƒëŒ€í¸ ì†Œí™˜ìˆ˜ë“¤ì„ ì „ì¥ ì¢Œí‘œì— ë§¤í•‘í•˜ì—¬ Mapì— ì¶”ê°€ (180ë„ íšŒì „ ì ìš©)
            // ë¦¬ë”ê°€ ì¡´ì¬í•˜ê³  ë°°ì¹˜ë˜ì–´ ìˆë‹¤ë©´, ë¨¼ì € ë¦¬ë”ë¥¼ ì „ì¥ ì¤‘ì•™ ì—´ì— ë§¤í•‘í•©ë‹ˆë‹¤.
            if (opponentLeaderSummoner && opponentLeaderSummoner.parentElement && opponentLeaderSummoner.parentElement.classList.contains('grid-cell')) {
                const key = `${battlefieldVerticalCenterRow},${opponentLeaderBattlefieldCol}`;
                if (!battlefieldPlacementMap.has(key)) battlefieldPlacementMap.set(key, []);
                battlefieldPlacementMap.get(key).push(opponentLeaderSummoner);
            }
            // ë¦¬ë”ê°€ ì•„ë‹Œ ìƒëŒ€í¸ì˜ ë‹¤ë¥¸ ì†Œí™˜ìˆ˜ë“¤ì„ ë¦¬ë”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒëŒ€ì ìœ¼ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤ (180ë„ íšŒì „ ì ìš©).
            opponentPlacedSummonersData.forEach(data => {
                if (!data.isLeader) { 
                    let bfRow, bfCol;
                    // ë°°ì¹˜ ê·¸ë¦¬ë“œ ë‚´ì—ì„œ 180ë„ íšŒì „ëœ ìƒëŒ€ì  ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                    const rotatedRow = (grid5x5Size - 1) - data.originalRow;
                    const rotatedCol = (grid5x5Size - 1) - data.originalCol;

                    if (opponentLeaderOriginalPos) { // ë¦¬ë”ê°€ ìˆì„ ê²½ìš°: ë¦¬ë”ì˜ íšŒì „ëœ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒëŒ€ì  ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                        const leaderRotatedRow = (grid5x5Size - 1) - opponentLeaderOriginalPos.originalRow;
                        const leaderRotatedCol = (grid5x5Size - 1) - opponentLeaderOriginalPos.originalCol;

                        const rowDiff = rotatedRow - leaderRotatedRow;
                        const colDiff = rotatedCol - leaderRotatedCol;
                        
                        bfRow = battlefieldVerticalCenterRow + rowDiff;
                        bfCol = opponentLeaderBattlefieldCol + colDiff;

                    } else { // ë¦¬ë”ê°€ ì—†ì„ ê²½ìš°: ìƒëŒ€ ê·¸ë¦¬ë“œ ì‹œì‘ì  (ì „ì¥ 2í–‰, 8ì—´) ê¸°ì¤€ìœ¼ë¡œ ë§¤í•‘ (íšŒì „ëœ ì¢Œí‘œ ì‚¬ìš©)
                        bfRow = battlefieldVerticalCenterRow - 2 + rotatedRow;
                        bfCol = 8 + rotatedCol; 
                    }
                    // ê³„ì‚°ëœ ì „ì¥ ì¢Œí‘œê°€ ìœ íš¨í•œ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸ í›„ Mapì— ì¶”ê°€í•©ë‹ˆë‹¤.
                    if (bfRow >= 0 && bfRow < battlefieldRows && bfCol >= 0 && bfCol < battlefieldCols) {
                        const key = `${bfRow},${bfCol}`;
                        if (!battlefieldPlacementMap.has(key)) battlefieldPlacementMap.set(key, []);
                        battlefieldPlacementMap.get(key).push(data.summoner);
                    }
                }
            });

            // Mapì— ë§¤í•‘ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ ì „ì¥ ì…€ì— ì†Œí™˜ìˆ˜ë“¤ì„ ë°°ì¹˜í•©ë‹ˆë‹¤.
            battlefieldPlacementMap.forEach((summonersInCell, key) => {
                const [rowStr, colStr] = key.split(',');
                const bfRow = parseInt(rowStr);
                const bfCol = parseInt(colStr);
                const battlefieldIndex = bfRow * battlefieldCols + bfCol;
                const bfCell = battlefieldCells[battlefieldIndex];

                // ì…€ì— ìˆëŠ” ì†Œí™˜ìˆ˜ ìˆ˜ì— ë”°ë¼ battlefield-cellì˜ ë‚´ë¶€ ê·¸ë¦¬ë“œ í…œí”Œë¦¿ì„ ë™ì ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
                if (summonersInCell.length === 1) {
                    bfCell.classList.remove('multi-summoners'); // 2ê°œ ì´ìƒì¼ ë•Œ ì ìš©ë˜ëŠ” í´ë˜ìŠ¤ ì œê±°
                    bfCell.classList.remove('three-plus'); // 3ê°œ ì´ìƒì¼ ë•Œ ì ìš©ë˜ëŠ” í´ë˜ìŠ¤ ì œê±°
                    bfCell.style.gridTemplateColumns = '1fr'; // 1x1 ê·¸ë¦¬ë“œ ìœ ì§€
                    bfCell.style.gridTemplateRows = '1fr';
                } else if (summonersInCell.length === 2) {
                    bfCell.classList.add('multi-summoners'); // 2ê°œì¼ ë•Œ: ê°€ë¡œ 2ë¶„í• , ì„¸ë¡œ 1ì¹¸ ê·¸ë¦¬ë“œ í™œì„±í™”
                    bfCell.classList.remove('three-plus'); // 3ê°œ ì´ìƒì¼ ë•Œ ì ìš©ë˜ëŠ” í´ë˜ìŠ¤ ì œê±°
                    bfCell.style.gridTemplateColumns = 'repeat(2, 1fr)'; 
                    bfCell.style.gridTemplateRows = '1fr'; 
                } else { /* summonersInCell.length >= 3 */
                    bfCell.classList.add('multi-summoners'); // 3ê°œ ì´ìƒì¼ ë•Œ: ê°€ë¡œ 2ë¶„í• , ì„¸ë¡œ 2ë¶„í•  ê·¸ë¦¬ë“œ í™œì„±í™”
                    bfCell.classList.add('three-plus'); // 2x2 ê·¸ë¦¬ë“œ í´ë˜ìŠ¤ ì¶”ê°€
                    bfCell.style.gridTemplateColumns = 'repeat(2, 1fr)'; 
                    bfCell.style.gridTemplateRows = 'repeat(2, 1fr)'; 
                }

                // 2x2 ê·¸ë¦¬ë“œ ë‚´ì—ì„œ ì†Œí™˜ìˆ˜ ë°°ì¹˜ ìœ„ì¹˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤ (ì¢Œìƒ, ìš°ìƒ, ì¢Œí•˜, ìš°í•˜).
                const positions2x2 = [[1,1], [1,2], [2,1], [2,2]]; 
                
                // í•´ë‹¹ ì…€ì— ë°°ì¹˜ë  ì†Œí™˜ìˆ˜ë“¤ì„ ìˆœíšŒí•˜ë©° ì‹¤ì œ DOM ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  ì¶”ê°€í•©ë‹ˆë‹¤.
                summonersInCell.forEach((summonerElement, index) => {
                    // ìµœëŒ€ 4ë§ˆë¦¬ê¹Œì§€ë§Œ í‘œì‹œí•©ë‹ˆë‹¤ (2x2 ê·¸ë¦¬ë“œ ìµœëŒ€).
                    if (index < positions2x2.length) { 
                        const bfSummoner = document.createElement('div');
                        bfSummoner.classList.add('battlefield-summoner'); // ì „ì¥ ì†Œí™˜ìˆ˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼
                        // ì†Œí™˜ìˆ˜ ì§„ì˜ì— ë”°ë¼ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ ì¶”ê°€
                        bfSummoner.classList.add(summonerElement.dataset.isOpponent === 'true' ? 'opponent-summoner' : 'my-summoner');
                        
                        // ì†Œí™˜ìˆ˜ ìˆ˜ì— ë”°ë¼ ë‹¤ë¥¸ í¬ê¸° í´ë˜ìŠ¤ ë¶€ì—¬ ë° ë‚´ë¶€ ê·¸ë¦¬ë“œ ìœ„ì¹˜ ì§€ì •
                        if (summonersInCell.length === 1) {
                            bfSummoner.classList.add('single-summoner'); // 1ë§ˆë¦¬ì¼ ë•Œ í° í¬ê¸°
                            bfSummoner.style.gridRowStart = '1';
                            bfSummoner.style.gridColumnStart = '1';
                        } else if (summonersInCell.length === 2) {
                            bfSummoner.classList.add('multi-summoner'); // 2ë§ˆë¦¬ì¼ ë•Œ ì¤‘ê°„ í¬ê¸°
                            bfSummoner.style.gridRowStart = '1'; // 1í–‰ ê³ ì •
                            bfSummoner.style.gridColumnStart = index + 1; // 1ì—´, 2ì—´ì— ë°°ì¹˜ (ê°€ë¡œë¡œ ë‚˜ë€íˆ)
                        } else { // 3ë§ˆë¦¬ ì´ìƒ: 2x2 ê·¸ë¦¬ë“œì— ë°°ì¹˜ë  ë•Œ ì‘ì€ í¬ê¸°
                            bfSummoner.classList.add('multi-summoner');
                            bfSummoner.style.gridRowStart = positions2x2[index][0];
                            bfSummoner.style.gridColumnStart = positions2x2[index][1];
                        }

                        // ì´ë¯¸ì§€ íƒœê·¸ë¥¼ ìƒì„±í•˜ì—¬ ì†Œí™˜ìˆ˜ ë‚´ë¶€ì— ì¶”ê°€í•©ë‹ˆë‹¤.
                        const img = document.createElement('img');
                        img.src = `${imagePath}${summonerElement.dataset.summonerName}${imageExtension}`;
                        img.alt = summonerElement.dataset.summonerName;
                        bfSummoner.appendChild(img);
                        
                        // ë¦¬ë” ì†Œí™˜ìˆ˜ì—ê²Œ ì™•ê´€ ë§ˆì»¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
                        if (summonerElement.dataset.isLeader === 'true') {
                            const leaderMarker = document.createElement('span');
                            leaderMarker.classList.add('battlefield-leader-marker');
                            leaderMarker.textContent = 'ğŸ‘‘';
                            bfSummoner.appendChild(leaderMarker);
                        }
                        bfCell.appendChild(bfSummoner); // ìµœì¢…ì ìœ¼ë¡œ ì „ì¥ ì…€ì— ì†Œí™˜ìˆ˜ ì¶”ê°€
                    }
                });
            });
        }

        /**
         * ì§€ì •ëœ ë°°ì¹˜ ê·¸ë¦¬ë“œì—ì„œ í˜„ì¬ ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ë“¤ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
         * ê° ì†Œí™˜ìˆ˜ì˜ ì´ë¦„, ë¦¬ë” ì—¬ë¶€, ì›ë˜ ê·¸ë¦¬ë“œ ë‚´ ìƒëŒ€ì  ìœ„ì¹˜ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤.
         * @param {HTMLElement} gridElement - ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•  ê·¸ë¦¬ë“œ DOM ìš”ì†Œ (myGrid ë˜ëŠ” opponentGrid)
         * @returns {Array<Object>} - ë°°ì¹˜ëœ ì†Œí™˜ìˆ˜ë“¤ì˜ ì •ë³´ ê°ì²´ ë°°ì—´
         */
        function collectSummonersData(gridElement) {
            const placedSummonersData = [];
            gridElement.querySelectorAll('.grid-cell').forEach(gridCell => { 
                if (gridCell.firstChild) { // ì…€ì— ì†Œí™˜ìˆ˜(í´ë¡ )ê°€ ìˆë‹¤ë©´
                    const summoner = gridCell.firstChild; // í´ë¡  ì†Œí™˜ìˆ˜ ì—˜ë¦¬ë¨¼íŠ¸
                    const name = summoner.dataset.summonerName;
                    const isLeader = summoner.dataset.isLeader === 'true';
                    const gridIndex = parseInt(gridCell.dataset.index); // ì…€ì˜ ì¸ë±ìŠ¤
                    const originalRow = Math.floor(gridIndex / grid5x5Size); // ë°°ì¹˜ ê·¸ë¦¬ë“œ ë‚´ ì›ë˜ í–‰
                    const originalCol = gridIndex % grid5x5Size; // ë°°ì¹˜ ê·¸ë¦¬ë“œ ë‚´ ì›ë˜ ì—´
                    placedSummonersData.push({ summoner, name, isLeader, originalRow, originalCol, gridIndex });
                }
            });
            return placedSummonersData;
        }

        /**
         * í˜„ì¬ í™œì„±í™”ëœ í¸ì„±ì— ë°°ì¹˜ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
         */
        function saveArrangement() {
            const myData = collectSummonersData(myGrid).map(s => ({
                name: s.name,
                isLeader: s.isLeader,
                gridIndex: s.gridIndex
            }));
            const opponentData = collectSummonersData(opponentGrid).map(s => ({
                name: s.name,
                isLeader: s.isLeader,
                gridIndex: s.gridIndex
            }));

            let allArrangementsData = {};
            try {
                const storedData = localStorage.getItem('summonerAllArrangements');
                if (storedData) {
                    allArrangementsData = JSON.parse(storedData);
                }
            } catch (e) {
                console.error("ì €ì¥ëœ ì „ì²´ í¸ì„± ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
            }

            // í˜„ì¬ í¸ì„±ì— ë°ì´í„° ì €ì¥
            allArrangementsData[`arrangement_${currentArrangementId}`] = {
                myPlacement: myData,
                opponentPlacement: opponentData
            };
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ í¸ì„± ID ëª©ë¡ ì—…ë°ì´íŠ¸ ë° ì €ì¥
            if (!availableArrangementIds.includes(currentArrangementId)) {
                availableArrangementIds.push(currentArrangementId);
                availableArrangementIds.sort((a, b) => a - b); // ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
                localStorage.setItem('availableArrangementIds', JSON.stringify(availableArrangementIds));
            }
            
            try {
                localStorage.setItem('summonerAllArrangements', JSON.stringify(allArrangementsData));
                isDirty = false; // ì €ì¥ í›„ clean ìƒíƒœë¡œ ë³€ê²½
                showToast(`í˜„ì¬ ë°°ì¹˜ê°€ '${arrangementNames[currentArrangementId] || `í¸ì„± ${currentArrangementId}`}'ì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            } catch (e) {
                showToast(`í¸ì„± ${currentArrangementId}ì— ì €ì¥ ì‹¤íŒ¨: ` + e);
            }
        }

        /**
         * ì§€ì •ëœ IDì˜ í¸ì„± ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
         * @param {number} arrangementId - ë¶ˆëŸ¬ì˜¬ í¸ì„±ì˜ ID
         */
        function loadArrangement(arrangementId) {
            if (isDirty) {
                if (!confirm('ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‹¤ë¥¸ í¸ì„±ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì„ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    return;
                }
            }

            currentArrangementId = arrangementId; // í˜„ì¬ í™œì„±í™”ëœ í¸ì„± ID ì—…ë°ì´íŠ¸
            updateArrangementButtonActiveState(); // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸

            let allArrangementsData = {};
            try {
                const storedData = localStorage.getItem('summonerAllArrangements');
                if (storedData) {
                    allArrangementsData = JSON.parse(storedData);
                }
            } catch (e) {
                console.error("ì €ì¥ëœ ì „ì²´ í¸ì„± ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                showToast('ì €ì¥ëœ í¸ì„± ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            const arrangementData = allArrangementsData[`arrangement_${arrangementId}`];

            // í˜„ì¬ ë°°ì¹˜ëœ ëª¨ë“  ì†Œí™˜ìˆ˜ ì œê±° (ì´ˆê¸°í™”)
            clearCurrentDisplay(true); // isDirty í”Œë˜ê·¸ë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  í™”ë©´ë§Œ ì´ˆê¸°í™”

            if (!arrangementData || (!arrangementData.myPlacement && !arrangementData.opponentPlacement)) {
                isDirty = false; // ë¹ˆ í¸ì„±ì„ ë¶ˆëŸ¬ì™”ìœ¼ë¯€ë¡œ clean ìƒíƒœ
                return;
            }

            const myLoadedData = arrangementData.myPlacement || [];
            const opponentLoadedData = arrangementData.opponentPlacement || [];

            // ë‚˜ì˜ ì†Œí™˜ìˆ˜ ë°°ì¹˜
            myLoadedData.forEach(data => {
                const targetCell = myGrid.querySelector(`.grid-cell[data-index="${data.gridIndex}"]`);
                if (targetCell) {
                    const originalSummoner = commonSummonersPool.querySelector(`[data-summoner-name="${data.name}"]`);
                    if (originalSummoner) { // summoner_images í´ë”ì— í•´ë‹¹ ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„
                        const newSummoner = originalSummoner.cloneNode(true);
                        newSummoner.classList.remove('summoner-draggable');
                        newSummoner.classList.add('is-placed');
                        newSummoner.removeAttribute('id');
                        newSummoner.setAttribute('draggable', true);
                        newSummoner.addEventListener('dragstart', dragStart);
                        newSummoner.dataset.isLeader = data.isLeader.toString();
                        newSummoner.dataset.isOpponent = 'false'; // ë‚˜ì˜ ì†Œí™˜ìˆ˜
                        targetCell.appendChild(newSummoner);
                        addSummonerButtons(newSummoner); // ë²„íŠ¼ ì¶”ê°€

                        // ë¡œë“œ ì‹œì ì— ë¦¬ë” ì°¸ì¡° ì—…ë°ì´íŠ¸
                        if (data.isLeader) {
                            myLeaderSummoner = newSummoner;
                        }
                        myPlacedSummoners++;
                    } else {
                        console.warn(`[í¸ì„± ë¶ˆëŸ¬ì˜¤ê¸°] ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${data.name}`);
                    }
                }
            });

            // ìƒëŒ€í¸ ì†Œí™˜ìˆ˜ ë°°ì¹˜
            opponentLoadedData.forEach(data => {
                const targetCell = opponentGrid.querySelector(`.grid-cell[data-index="${data.gridIndex}"]`);
                if (targetCell) {
                    const originalSummoner = commonSummonersPool.querySelector(`[data-summoner-name="${data.name}"]`);
                    if (originalSummoner) { // summoner_images í´ë”ì— í•´ë‹¹ ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„
                        const newSummoner = originalSummoner.cloneNode(true);
                        newSummoner.classList.remove('summoner-draggable');
                        newSummoner.classList.add('is-placed');
                        newSummoner.removeAttribute('id');
                        newSummoner.setAttribute('draggable', true);
                        newSummoner.addEventListener('dragstart', dragStart);
                        newSummoner.dataset.isLeader = data.isLeader.toString();
                        newSummoner.dataset.isOpponent = 'true'; // ìƒëŒ€í¸ ì†Œí™˜ìˆ˜
                        targetCell.appendChild(newSummoner);
                        addSummonerButtons(newSummoner); // ë²„íŠ¼ ì¶”ê°€

                        // ë¡œë“œ ì‹œì ì— ë¦¬ë” ì°¸ì¡° ì—…ë°ì´íŠ¸
                        if (data.isLeader) {
                            opponentLeaderSummoner = newSummoner;
                        }
                        opponentPlacedSummoners++;
                    } else {
                        console.warn(`[í¸ì„± ë¶ˆëŸ¬ì˜¤ê¸°] ì†Œí™˜ìˆ˜ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${data.name}`);
                    }
                }
            });

            updateLeaderMarkers();
            updatePlacementCountDisplays();
            updateBattlefield();
            isDirty = false; // ìƒˆë¡œìš´ í¸ì„±ì„ ë¶ˆëŸ¬ì™”ìœ¼ë¯€ë¡œ clean ìƒíƒœë¡œ ì´ˆê¸°í™”
        }

        /**
         * í˜„ì¬ í™”ë©´ì— í‘œì‹œëœ ëª¨ë“  ë°°ì¹˜ ê·¸ë¦¬ë“œë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         * @param {boolean} silent - trueì¼ ê²½ìš° isDirty í”Œë˜ê·¸ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠìŒ (í¸ì„± ë¡œë“œ ì‹œ ë‚´ë¶€ ì‚¬ìš©)
         */
        function clearCurrentDisplay(silent = false) {
            const wasEmpty = myPlacedSummoners === 0 && opponentPlacedSummoners === 0;

            // ë‚˜ì˜ ê·¸ë¦¬ë“œ ì†Œí™˜ìˆ˜ ì œê±°
            myGrid.querySelectorAll('.grid-cell').forEach(cell => {
                if (cell.firstChild) cell.removeChild(cell.firstChild);
            });
            myPlacedSummoners = 0;
            myLeaderSummoner = null;

            // ìƒëŒ€í¸ ê·¸ë¦¬ë“œ ì†Œí™˜ìˆ˜ ì œê±°
            opponentGrid.querySelectorAll('.grid-cell').forEach(cell => {
                if (cell.firstChild) cell.removeChild(cell.firstChild);
            });
            opponentPlacedSummoners = 0;
            opponentLeaderSummoner = null;

            // UI ì—…ë°ì´íŠ¸
            updateLeaderMarkers();
            updatePlacementCountDisplays();
            updateBattlefield();

            if (!silent && !wasEmpty) {
                isDirty = true; // ë¹„ì–´ìˆì§€ ì•Šì€ ìƒíƒœì—ì„œ í´ë¦¬ì–´í–ˆë‹¤ë©´ ë³€ê²½ì‚¬í•­ìœ¼ë¡œ ê°„ì£¼
            }
        }

        /**
         * í˜„ì¬ í™œì„±í™”ëœ í¸ì„±ì˜ ì €ì¥ëœ ë°ì´í„°ë¥¼ ì§€ì›ë‹ˆë‹¤.
         */
        function clearCurrentArrangementData() {
            if (isDirty) {
                if (!confirm('ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  í˜„ì¬ í¸ì„±ì„ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            } else {
                if (!confirm(`ì •ë§ í˜„ì¬ í¸ì„± '${arrangementNames[currentArrangementId] || `í¸ì„± ${currentArrangementId}`}'ì˜ í™”ë©´ ë°°ì¹˜ë¥¼ ëª¨ë‘ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    return;
                }
            }
            clearCurrentDisplay();
        }

        /**
         * localStorageì˜ ëª¨ë“  í¸ì„± ë°ì´í„°ë¥¼ ì§€ìš°ê³ , í™”ë©´ì˜ ë°°ì¹˜ë„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         */
        function clearAllArrangements() {
            if (isDirty) {
                if (!confirm('ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  ëª¨ë“  í¸ì„±ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            } else {
                if (!confirm('ì •ë§ ëª¨ë“  ì €ì¥ëœ í¸ì„± ìŠ¬ë¡¯ì„ ì´ˆê¸°í™”í•˜ê³  í˜„ì¬ ë°°ì¹˜ë„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }

            try {
                localStorage.removeItem('summonerAllArrangements');
                localStorage.removeItem('availableArrangementIds');
                localStorage.removeItem('summonerArrangementNames');
                localStorage.removeItem('lastActiveArrangementId');
                
                availableArrangementIds = [];
                arrangementNames = {};
                
                showToast('ëª¨ë“  ì €ì¥ëœ í¸ì„± ìŠ¬ë¡¯ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
                clearCurrentDisplay(true); // í™”ë©´ ì´ˆê¸°í™” (isDirtyëŠ” falseë¡œ)
                renderArrangementButtons(); 
                addInitialArrangement();
                isDirty = false;

            } catch (e) {
                showToast('ëª¨ë“  ì €ì¥ëœ í¸ì„± ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + e);
            }
        }

        /**
         * í¸ì„± ì„ íƒ ë²„íŠ¼ì˜ í™œì„±í™” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateArrangementButtonActiveState() {
            document.querySelectorAll('.arrangement-button').forEach(button => {
                if (parseInt(button.dataset.arrangementId) === currentArrangementId) {
                    button.classList.add('active-arrangement');
                } else {
                    button.classList.remove('active-arrangement');
                }
            });
        }

        /**
         * ìƒˆë¡œìš´ í¸ì„± ìŠ¬ë¡¯ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
         */
        function addArrangement() {
            if (availableArrangementIds.length >= maxArrangements) {
                showToast(`ìµœëŒ€ í¸ì„± ê°œìˆ˜(${maxArrangements}ê°œ)ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.`);
                return;
            }

            if (isDirty) {
                if (!confirm('ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ í¸ì„±ì„ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }

            // ìƒˆë¡œìš´ í¸ì„± ID ì°¾ê¸° (ê°€ì¥ ì‘ì€ ì‚¬ìš© ê°€ëŠ¥í•œ ì–‘ì˜ ì •ìˆ˜)
            let newArrangementId = 1;
            while (availableArrangementIds.includes(newArrangementId)) {
                newArrangementId++;
            }
            
            availableArrangementIds.push(newArrangementId);
            availableArrangementIds.sort((a, b) => a - b); // ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
            localStorage.setItem('availableArrangementIds', JSON.stringify(availableArrangementIds));
            
            renderArrangementButtons(); // ë²„íŠ¼ UI ê°±ì‹ 
            loadArrangement(newArrangementId); 
            showToast(`ìƒˆë¡œìš´ í¸ì„± ${newArrangementId}ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        /**
         * í¸ì„± ë²„íŠ¼ë“¤ì„ UIì— ë Œë”ë§í•©ë‹ˆë‹¤. (ì¶”ê°€/ì‚­ì œ ì‹œ í˜¸ì¶œ)
         */
        function renderArrangementButtons() {
            const existingArrangementItems = arrangementButtonsContainer.querySelectorAll('.arrangement-item');
            existingArrangementItems.forEach(item => item.remove());

            availableArrangementIds.forEach(id => {
                const arrangementItem = document.createElement('div');
                arrangementItem.classList.add('arrangement-item');

                const button = document.createElement('button');
                button.classList.add('arrangement-button');
                button.dataset.arrangementId = id;
                button.textContent = arrangementNames[id] || `í¸ì„± ${id}`;
                button.addEventListener('click', () => loadArrangement(id));
                arrangementItem.appendChild(button);

                // ì´ë¦„ ë³€ê²½ ë²„íŠ¼ ì¶”ê°€
                const renameButton = document.createElement('button');
                renameButton.classList.add('rename-arrangement-button');
                renameButton.innerHTML = 'âœï¸';
                renameButton.title = 'ì´ë¦„ ë³€ê²½';
                renameButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    renameArrangement(id);
                });
                arrangementItem.appendChild(renameButton);

                // ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
                const deleteButton = document.createElement('button');
                deleteButton.classList.add('delete-arrangement-button');
                deleteButton.textContent = 'X';
                deleteButton.title = 'í¸ì„± ì‚­ì œ';
                deleteButton.dataset.arrangementIdToDelete = id;
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    deleteArrangement(id);
                });
                arrangementItem.appendChild(deleteButton);
                
                arrangementButtonsContainer.insertBefore(arrangementItem, addArrangementButton);
            });

            updateArrangementButtonActiveState();
        }

        /**
         * í¸ì„±ì˜ ì´ë¦„ì„ ë³€ê²½í•©ë‹ˆë‹¤.
         * @param {number} arrangementId - ì´ë¦„ì„ ë³€ê²½í•  í¸ì„±ì˜ ID
         */
        function renameArrangement(arrangementId) {
            const currentName = arrangementNames[arrangementId] || `í¸ì„± ${arrangementId}`;
            const newName = prompt('ìƒˆë¡œìš´ í¸ì„± ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', currentName);

            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                arrangementNames[arrangementId] = newName.trim();
                localStorage.setItem('summonerArrangementNames', JSON.stringify(arrangementNames));
                showToast('í¸ì„± ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                renderArrangementButtons(); // ë²„íŠ¼ UI ê°±ì‹ 
                isDirty = true; // ì´ë¦„ ë³€ê²½ë„ ì €ì¥ í•„ìš”í•œ ë³€ê²½ì‚¬í•­ìœ¼ë¡œ ê°„ì£¼
            }
        }

        /**
         * íŠ¹ì • í¸ì„± IDì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.
         * @param {number} arrangementIdToDelete - ì‚­ì œí•  í¸ì„±ì˜ ID
         */
        function deleteArrangement(arrangementIdToDelete) {
            const arrangementName = arrangementNames[arrangementIdToDelete] || `í¸ì„± ${arrangementIdToDelete}`;
            if (!confirm(`ì •ë§ '${arrangementName}' í¸ì„±ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì €ì¥ëœ ë°°ì¹˜ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤)`)) {
                return;
            }

            // ì‚­ì œí•˜ë ¤ëŠ” í¸ì„±ì´ í˜„ì¬ í™œì„±í™”ëœ í¸ì„±ì´ê³ , ë³€ê²½ì‚¬í•­ì´ ìˆëŠ” ê²½ìš° í•œ ë²ˆ ë” í™•ì¸
            if (isDirty && currentArrangementId === arrangementIdToDelete) {
                if (!confirm('í˜„ì¬ í¸ì„±ì— ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }

            // 1. ID ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ì €ì¥
            availableArrangementIds = availableArrangementIds.filter(id => id !== arrangementIdToDelete);
            localStorage.setItem('availableArrangementIds', JSON.stringify(availableArrangementIds));

            // 2. ì´ë¦„ ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ì €ì¥
            if (arrangementNames[arrangementIdToDelete]) {
                delete arrangementNames[arrangementIdToDelete];
                localStorage.setItem('summonerArrangementNames', JSON.stringify(arrangementNames));
            }

            // 3. ë°°ì¹˜ ë°ì´í„°ì—ì„œ ì œê±°í•˜ê³  ì €ì¥
            let allArrangementsData = {};
            try {
                const storedData = localStorage.getItem('summonerAllArrangements');
                if (storedData) {
                    allArrangementsData = JSON.parse(storedData);
                    if (allArrangementsData[`arrangement_${arrangementIdToDelete}`]) {
                        delete allArrangementsData[`arrangement_${arrangementIdToDelete}`];
                        localStorage.setItem('summonerAllArrangements', JSON.stringify(allArrangementsData));
                    }
                }
            } catch (e) {
                console.error("ì €ì¥ëœ ì „ì²´ í¸ì„± ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
                showToast('ì €ì¥ëœ ë°ì´í„°ë¥¼ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                return; // ì—¬ê¸°ì„œ ì¤‘ë‹¨
            }

            showToast(`'${arrangementName}' í¸ì„±ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            renderArrangementButtons(); // ë²„íŠ¼ UI ê°±ì‹ 

            // ì‚­ì œëœ í¸ì„±ì´ í˜„ì¬ í™œì„±í™”ëœ í¸ì„±ì´ì—ˆë‹¤ë©´ ë‹¤ë¥¸ í¸ì„±ìœ¼ë¡œ ì „í™˜
            if (currentArrangementId === arrangementIdToDelete) {
                isDirty = false; // ì‚­ì œí–ˆìœ¼ë¯€ë¡œ í˜„ì¬ ìƒíƒœëŠ” clean
                if (availableArrangementIds.length > 0) {
                    loadArrangement(availableArrangementIds[0]); 
                } else {
                    addInitialArrangement();
                }
            } else {
                updateArrangementButtonActiveState();
            }
        }

        /**
         * ìµœì´ˆ ë¡œë“œ ì‹œ í¸ì„± 1ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function addInitialArrangement() {
            if (availableArrangementIds.length === 0) {
                availableArrangementIds = [1];
                localStorage.setItem('availableArrangementIds', JSON.stringify(availableArrangementIds));
                currentArrangementId = 1;
                renderArrangementButtons();
                loadArrangement(1);
            }
        }

        /**
         * í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ í™”ë©´ ì¤‘ì•™ì— ë„ìš°ê³  1ì´ˆ ë’¤ ì‚¬ë¼ì§€ê²Œ í•©ë‹ˆë‹¤.
         * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€ í…ìŠ¤íŠ¸
         * @param {number} duration - ë©”ì‹œì§€ê°€ í‘œì‹œë  ì‹œê°„ (ë°€ë¦¬ì´ˆ), ê¸°ë³¸ê°’ 1000ms
         */
        function showToast(message, duration = 1000) {
            clearTimeout(toastTimeout); 
            toastMessage.textContent = message;
            toastMessage.classList.add('show');
            toastTimeout = setTimeout(() => {
                toastMessage.classList.remove('show');
            }, duration);
        }


        // --- ì´ˆê¸°í™” ë¡œì§ ---
        createBattlefieldGrid(); 
        createGrid(myGrid, 'my'); 
        createGrid(opponentGrid, 'opponent'); 
        createCommonSummonerPool(); 

        // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const storedArrangementIds = localStorage.getItem('availableArrangementIds');
        const storedArrangementNames = localStorage.getItem('summonerArrangementNames');

        if (storedArrangementNames) {
            try {
                arrangementNames = JSON.parse(storedArrangementNames);
            } catch (e) {
                console.error("ì €ì¥ëœ í¸ì„± ì´ë¦„ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜", e);
                arrangementNames = {};
            }
        }

        if (storedArrangementIds) {
            try {
                availableArrangementIds = JSON.parse(storedArrangementIds);
                if (availableArrangementIds.length > 0) {
                    const lastActiveArrangementId = parseInt(localStorage.getItem('lastActiveArrangementId')) || availableArrangementIds[0];
                    currentArrangementId = availableArrangementIds.includes(lastActiveArrangementId) ? lastActiveArrangementId : availableArrangementIds[0];
                } else {
                    addInitialArrangement();
                }
            } catch (e) {
                 console.error("ì €ì¥ëœ í¸ì„± ID ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜", e);
                 addInitialArrangement();
            }
        } else {
            addInitialArrangement();
        }
        
        addArrangementButton.addEventListener('click', addArrangement);

        renderArrangementButtons();
        
        if (availableArrangementIds.length > 0) {
            loadArrangement(currentArrangementId);
        } else {
            updatePlacementCountDisplays();
            updateBattlefield();
        }

        // ì œì–´ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        document.getElementById('save-arrangement-button').addEventListener('click', saveArrangement);
        document.getElementById('clear-current-arrangement-button').addEventListener('click', clearCurrentArrangementData);
        document.getElementById('clear-all-arrangements-button').addEventListener('click', clearAllArrangements);

        // í˜ì´ì§€ë¥¼ ë– ë‚˜ê¸° ì „ ë³€ê²½ì‚¬í•­ í™•ì¸
        window.addEventListener('beforeunload', (e) => {
            if (isDirty) {
                e.preventDefault(); // í‘œì¤€ì— ë”°ë¼ í•„ìš”
                e.returnValue = ''; // Chromeì—ì„œ í•„ìš”
            }
            // í˜„ì¬ í™œì„±í™”ëœ í¸ì„± ID ì €ì¥
            if (currentArrangementId !== 0 && availableArrangementIds.length > 0) {
                localStorage.setItem('lastActiveArrangementId', currentArrangementId.toString());
            } else {
                localStorage.removeItem('lastActiveArrangementId');
            }
        });

    </script>
</body>
</html>
